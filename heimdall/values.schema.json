{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "properties": {
    "nodeEnv": {
      "type": "string",
      "enum": ["production", "development", "test"],
      "description": "Node environment (production recommended for deployments)"
    },
    "classificationBannerText": {
      "type": "string",
      "description": "Classification banner text (e.g., 'UNCLASSIFIED', 'SECRET')"
    },
    "classificationBannerTextColor": {
      "type": "string",
      "description": "Classification banner text color (default: white)"
    },
    "classificationBannerColor": {
      "type": "string",
      "description": "Classification banner background color (default: red)"
    },
    "adminEmail": {
      "type": "string",
      "format": "email",
      "description": "Admin user email (default: admin@heimdall.local)"
    },
    "adminUsesExternalAuth": {
      "type": "boolean",
      "description": "Whether admin user authenticates via external provider"
    },
    "adminPassword": {
      "type": "string",
      "minLength": 8,
      "description": "Admin password (minimum 8 characters, auto-generated if not set)"
    },
    "localLoginDisabled": {
      "type": "boolean",
      "description": "Disable local username/password login"
    },
    "registrationDisabled": {
      "type": "boolean",
      "description": "Disable new user registration"
    },
    "oneSessionPerUser": {
      "type": "boolean",
      "description": "Limit users to one active session"
    },
    "jwtSecret": {
      "type": "string",
      "minLength": 64,
      "description": "JWT signing secret (generate with: openssl rand -hex 64)"
    },
    "jwtExpireTime": {
      "type": "string",
      "pattern": "^[0-9]+(s|m|h|d)$",
      "description": "JWT expiration time (e.g., '25m', '1d')"
    },
    "apiKeySecret": {
      "type": "string",
      "minLength": 33,
      "description": "API key secret (generate with: openssl rand -hex 33)"
    },
    "maxFileUploadSize": {
      "type": "integer",
      "minimum": 1,
      "maximum": 1024,
      "description": "Maximum file upload size in megabytes (default: 50)"
    },
    "databaseHost": {
      "type": "string",
      "description": "External database hostname (only if postgresql.enabled=false)"
    },
    "databasePort": {
      "type": "integer",
      "minimum": 1,
      "maximum": 65535,
      "description": "Database port (default: 5432)"
    },
    "databaseName": {
      "type": "string",
      "minLength": 1,
      "description": "Database name"
    },
    "databaseUsername": {
      "type": "string",
      "minLength": 1,
      "description": "Database username"
    },
    "databasePassword": {
      "type": "string",
      "minLength": 8,
      "description": "Database password (generate with: openssl rand -hex 33)"
    },
    "databaseSsl": {
      "type": "boolean",
      "description": "Enable SSL for database connection"
    },
    "databaseSslInsecure": {
      "type": "boolean",
      "description": "Allow insecure SSL connections (self-signed certs)"
    },
    "databaseSslKey": {
      "type": "string",
      "description": "Database SSL client key (path or raw key)"
    },
    "databaseSslCert": {
      "type": "string",
      "description": "Database SSL client certificate (path or raw cert)"
    },
    "databaseSslCa": {
      "type": "string",
      "description": "Database SSL CA certificate (path or raw CA)"
    },
    "externalUrl": {
      "type": "string",
      "format": "uri",
      "pattern": "^https?://",
      "description": "Public-facing URL for Heimdall (required for OAuth callbacks)"
    },
    "splunkHostUrl": {
      "type": "string",
      "format": "uri",
      "pattern": "^https?://",
      "description": "Splunk integration URL"
    },
    "tenableHostUrl": {
      "type": "string",
      "format": "uri",
      "pattern": "^https?://",
      "description": "Tenable integration URL"
    },
    "forceTenableFrontend": {
      "type": "boolean",
      "description": "Force Tenable.SC Lite features in frontend"
    },
    "ldapEnabled": {
      "type": "boolean",
      "description": "Enable LDAP authentication"
    },
    "ldapHost": {
      "type": "string",
      "description": "LDAP server hostname (required if ldapEnabled=true)"
    },
    "ldapPort": {
      "type": "integer",
      "minimum": 1,
      "maximum": 65535,
      "description": "LDAP server port (default: 389, SSL: 636)"
    },
    "ldapBindDn": {
      "type": "string",
      "description": "LDAP bind DN for user lookups (required if ldapEnabled=true)"
    },
    "ldapPassword": {
      "type": "string",
      "description": "LDAP bind user password (required if ldapEnabled=true)"
    },
    "ldapSearchBase": {
      "type": "string",
      "description": "LDAP search base DN (e.g., 'OU=Users,DC=example,DC=com')"
    },
    "ldapSearchFilter": {
      "type": "string",
      "description": "LDAP search filter (e.g., 'sAMAccountName={{username}}')"
    },
    "ldapNameField": {
      "type": "string",
      "description": "LDAP attribute for user's name (default: name)"
    },
    "ldapMailField": {
      "type": "string",
      "description": "LDAP attribute for user's email (default: mail)"
    },
    "ldapSsl": {
      "type": "boolean",
      "description": "Use SSL/TLS for LDAP connection"
    },
    "ldapSslInsecure": {
      "type": "boolean",
      "description": "Allow insecure LDAP SSL connections"
    },
    "ldapSslCa": {
      "type": "string",
      "description": "LDAP SSL CA certificate (path or raw CA)"
    },
    "googleClientId": {
      "type": "string",
      "description": "Google OAuth client ID"
    },
    "googleClientSecret": {
      "type": "string",
      "description": "Google OAuth client secret"
    },
    "githubClientId": {
      "type": "string",
      "description": "GitHub OAuth client ID"
    },
    "githubClientSecret": {
      "type": "string",
      "description": "GitHub OAuth client secret"
    },
    "githubEnterpriseInstanceBaseUrl": {
      "type": "string",
      "format": "uri",
      "description": "GitHub Enterprise base URL (default: https://github.com/)"
    },
    "githubEnterpriseInstanceApiUrl": {
      "type": "string",
      "format": "uri",
      "description": "GitHub Enterprise API URL (default: https://api.github.com/)"
    },
    "gitlabClientId": {
      "type": "string",
      "description": "GitLab OAuth client ID"
    },
    "gitlabClientSecret": {
      "type": "string",
      "description": "GitLab OAuth client secret"
    },
    "gitlabBaseUrl": {
      "type": "string",
      "format": "uri",
      "description": "GitLab base URL (default: https://gitlab.com/)"
    },
    "httpsProxy": {
      "type": "string",
      "format": "uri",
      "description": "HTTPS proxy URL (e.g., http://proxy.example.com:8080)"
    },
    "oktaDomain": {
      "type": "string",
      "pattern": "^[a-zA-Z0-9.-]+\\.okta\\.com$",
      "description": "Okta domain (e.g., yourdomain.okta.com)"
    },
    "oktaClientId": {
      "type": "string",
      "description": "Okta OAuth client ID"
    },
    "oktaClientSecret": {
      "type": "string",
      "description": "Okta OAuth client secret"
    },
    "oktaIssuer": {
      "type": "string",
      "format": "uri",
      "description": "Okta issuer URL (alternative to oktaDomain)"
    },
    "oktaAuthorizationUrl": {
      "type": "string",
      "format": "uri",
      "description": "Okta authorization endpoint"
    },
    "oktaTokenUrl": {
      "type": "string",
      "format": "uri",
      "description": "Okta token endpoint"
    },
    "oktaUserInfoUrl": {
      "type": "string",
      "format": "uri",
      "description": "Okta userinfo endpoint"
    },
    "oktaUseHttpsProxy": {
      "type": "boolean",
      "description": "Use HTTPS_PROXY for Okta connections"
    },
    "oidcName": {
      "type": "string",
      "description": "OIDC provider name (displayed in UI)"
    },
    "oidcIssuer": {
      "type": "string",
      "format": "uri",
      "description": "OIDC issuer URL"
    },
    "oidcAuthorizationUrl": {
      "type": "string",
      "format": "uri",
      "description": "OIDC authorization endpoint"
    },
    "oidcTokenUrl": {
      "type": "string",
      "format": "uri",
      "description": "OIDC token endpoint"
    },
    "oidcUserInfoUrl": {
      "type": "string",
      "format": "uri",
      "description": "OIDC userinfo endpoint"
    },
    "oidcUsesVerifiedEmail": {
      "type": "boolean",
      "description": "Require verified email from OIDC provider (default: true)"
    },
    "oidcClientId": {
      "type": "string",
      "description": "OIDC client ID"
    },
    "oidcClientSecret": {
      "type": "string",
      "description": "OIDC client secret"
    },
    "oidcExternalGroups": {
      "type": "boolean",
      "description": "Use external groups from OIDC provider"
    },
    "oidcUsesPKCES256": {
      "type": "boolean",
      "description": "Use PKCE with S256 code challenge method"
    },
    "oidcUsesPKCEPlain": {
      "type": "boolean",
      "description": "Use PKCE with plain code challenge method"
    },
    "oidcUseHttpsProxy": {
      "type": "boolean",
      "description": "Use HTTPS_PROXY for OIDC connections"
    },
    "sops": {
      "type": "object",
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Enable SOPS encrypted secrets"
        },
        "secrets": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "List of secret keys to encrypt with SOPS"
        }
      }
    },
    "postgresql": {
      "type": "object",
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Deploy PostgreSQL StatefulSet (false for external DB)"
        },
        "image": {
          "type": "object",
          "properties": {
            "repository": { "type": "string" },
            "tag": { "type": "string" },
            "pullPolicy": {
              "type": "string",
              "enum": ["Always", "IfNotPresent", "Never"]
            }
          }
        },
        "persistence": {
          "type": "object",
          "properties": {
            "enabled": { "type": "boolean" },
            "size": { "type": "string" },
            "storageClassName": { "type": "string" },
            "accessMode": {
              "type": "string",
              "enum": ["ReadWriteOnce", "ReadWriteMany", "ReadOnlyMany"]
            }
          }
        },
        "service": {
          "type": "object",
          "properties": {
            "type": {
              "type": "string",
              "enum": ["ClusterIP", "NodePort", "LoadBalancer"]
            },
            "port": {
              "type": "integer",
              "minimum": 1,
              "maximum": 65535
            }
          }
        },
        "resources": {
          "type": "object"
        },
        "podAnnotations": {
          "type": "object"
        },
        "podSecurityContext": {
          "type": "object"
        },
        "securityContext": {
          "type": "object"
        },
        "nodeSelector": {
          "type": "object"
        },
        "tolerations": {
          "type": "array"
        },
        "affinity": {
          "type": "object"
        }
      }
    },
    "certs": {
      "type": "object",
      "properties": {
        "enabled": { "type": "boolean" },
        "systemCertsApproach": {
          "type": "object",
          "properties": {
            "enabled": { "type": "boolean" }
          }
        },
        "name": { "type": "string" },
        "certificates": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "filename": { "type": "string" },
              "contents": { "type": "string" }
            },
            "required": ["filename", "contents"]
          }
        }
      }
    },
    "heimdall": {
      "type": "object",
      "properties": {
        "image": {
          "type": "object",
          "properties": {
            "repository": { "type": "string" },
            "tag": { "type": "string" },
            "pullPolicy": {
              "type": "string",
              "enum": ["Always", "IfNotPresent", "Never"]
            }
          },
          "required": ["repository", "tag"]
        },
        "service": {
          "type": "object",
          "properties": {
            "type": {
              "type": "string",
              "enum": ["ClusterIP", "NodePort", "LoadBalancer"]
            },
            "port": {
              "type": "integer",
              "minimum": 1,
              "maximum": 65535
            }
          }
        },
        "ingress": {
          "type": "object",
          "properties": {
            "enabled": { "type": "boolean" },
            "apiVersion": { "type": "string" },
            "kind": { "type": "string" },
            "className": { "type": "string" },
            "hosts": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "host": { "type": "string" },
                  "paths": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "properties": {
                        "path": { "type": "string" },
                        "pathType": {
                          "type": "string",
                          "enum": ["Prefix", "Exact", "ImplementationSpecific"]
                        }
                      }
                    }
                  }
                }
              }
            },
            "tls": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "secretName": { "type": "string" },
                  "hosts": {
                    "type": "array",
                    "items": { "type": "string" }
                  }
                }
              }
            }
          }
        },
        "gateway": {
          "type": "object",
          "properties": {
            "enabled": { "type": "boolean" }
          }
        },
        "livenessProbe": {
          "type": "object",
          "properties": {
            "httpGet": {
              "type": "object",
              "properties": {
                "path": { "type": "string" },
                "port": { "type": "integer" }
              }
            },
            "initialDelaySeconds": { "type": "integer", "minimum": 0 },
            "periodSeconds": { "type": "integer", "minimum": 1 },
            "timeoutSeconds": { "type": "integer", "minimum": 1 },
            "failureThreshold": { "type": "integer", "minimum": 1 }
          }
        },
        "readinessProbe": {
          "type": "object",
          "properties": {
            "httpGet": {
              "type": "object",
              "properties": {
                "path": { "type": "string" },
                "port": { "type": "integer" }
              }
            },
            "initialDelaySeconds": { "type": "integer", "minimum": 0 },
            "periodSeconds": { "type": "integer", "minimum": 1 },
            "timeoutSeconds": { "type": "integer", "minimum": 1 },
            "failureThreshold": { "type": "integer", "minimum": 1 }
          }
        },
        "resources": {
          "type": "object",
          "properties": {
            "requests": {
              "type": "object",
              "properties": {
                "cpu": { "type": "string" },
                "memory": { "type": "string" }
              }
            },
            "limits": {
              "type": "object",
              "properties": {
                "cpu": { "type": "string" },
                "memory": { "type": "string" }
              }
            }
          }
        },
        "podAnnotations": { "type": "object" },
        "podSecurityContext": { "type": "object" },
        "securityContext": { "type": "object" },
        "nodeSelector": { "type": "object" },
        "tolerations": { "type": "array" },
        "affinity": { "type": "object" },
        "imagePullSecrets": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "name": { "type": "string" }
            }
          }
        },
        "config": {
          "type": "object",
          "description": "Additional environment variables for Heimdall",
          "properties": {
            "EXTERNAL_URL": {
              "type": "string",
              "format": "uri",
              "pattern": "^https?://[^/]+$",
              "description": "Public-facing base URL (e.g., https://heimdall.example.com). MUST NOT include /authn path - this is added automatically by Heimdall."
            },
            "GITHUB_CLIENTID": {
              "type": "string",
              "minLength": 1,
              "description": "GitHub OAuth Client ID (requires GITHUB_CLIENTSECRET). CRITICAL: OAuth button appears only when this variable is set."
            },
            "GITLAB_CLIENTID": {
              "type": "string",
              "minLength": 1,
              "description": "GitLab OAuth Client ID (requires GITLAB_SECRET - note inconsistent naming). CRITICAL: OAuth button appears only when this variable is set."
            },
            "GITLAB_BASEURL": {
              "type": "string",
              "format": "uri",
              "pattern": "^https?://[^/]+$",
              "description": "GitLab instance URL without trailing slash (e.g., https://gitlab.example.com)"
            },
            "GOOGLE_CLIENTID": {
              "type": "string",
              "minLength": 1,
              "description": "Google OAuth Client ID (requires GOOGLE_CLIENTSECRET). CRITICAL: OAuth button appears only when this variable is set."
            },
            "OIDC_CLIENTID": {
              "type": "string",
              "minLength": 1,
              "description": "OIDC Client ID (requires OIDC_CLIENT_SECRET - note inconsistent naming). CRITICAL: OAuth button appears only when this variable is set."
            },
            "OIDC_ISSUER": {
              "type": "string",
              "format": "uri",
              "pattern": "^https?://",
              "description": "OIDC Issuer URL (e.g., https://auth.example.com)"
            },
            "OIDC_AUTHORIZATION_URL": {
              "type": "string",
              "format": "uri",
              "pattern": "^https?://",
              "description": "OIDC Authorization endpoint URL"
            },
            "OIDC_TOKEN_URL": {
              "type": "string",
              "format": "uri",
              "pattern": "^https?://",
              "description": "OIDC Token endpoint URL"
            },
            "OIDC_USER_INFO_URL": {
              "type": "string",
              "format": "uri",
              "pattern": "^https?://",
              "description": "OIDC UserInfo endpoint URL"
            },
            "OKTA_CLIENTID": {
              "type": "string",
              "minLength": 1,
              "description": "Okta OAuth Client ID (requires OKTA_CLIENTSECRET). CRITICAL: OAuth button appears only when this variable is set."
            },
            "OKTA_DOMAIN": {
              "type": "string",
              "pattern": "^[a-z0-9-]+\\.(okta|oktapreview|okta-emea)\\.com$",
              "description": "Okta domain (e.g., example.okta.com)"
            },
            "OKTA_ISSUER": {
              "type": "string",
              "format": "uri",
              "pattern": "^https://[a-z0-9-]+\\.(okta|oktapreview|okta-emea)\\.com",
              "description": "Okta Issuer URL (e.g., https://example.okta.com/oauth2/default)"
            },
            "LDAP_ENABLED": {
              "type": "string",
              "enum": ["true", "false"],
              "description": "Enable LDAP authentication"
            },
            "LDAP_PORT": {
              "type": "string",
              "pattern": "^[1-9][0-9]{0,4}$",
              "description": "LDAP port (1-65535, common: 389 for plain, 636 for SSL)"
            }
          },
          "additionalProperties": {
            "type": "string"
          }
        }
      }
    }
  },
  "required": ["nodeEnv", "databaseName", "databaseUsername"]
}
