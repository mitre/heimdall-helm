---
title: Inline Secrets (CI/CD)
description: Inject secrets from environment variables for automated deployments
navigation:
  icon: i-lucide-workflow
---

::note{title="Best for CI/CD Pipelines"}
Use this approach for automated deployments where secrets are injected from environment variables or vault CLI.
::

## Configuration

```yaml
heimdall:
  secrets:
    JWT_SECRET: "your-secret-key-128-chars"
    API_KEY_SECRET: "your-api-key-secret-66-chars"
    DATABASE_PASSWORD: "your-db-password"
    ADMIN_PASSWORD: "your-admin-password"
```

::caution{title="Never Hardcode in Files"}
Do NOT hardcode secrets in values.yaml files committed to git. Use `--set` flags or environment variable substitution.
::

## GitHub Actions

```yaml
name: Deploy Heimdall
on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Deploy to Kubernetes
        env:
          JWT_SECRET: ${{ secrets.JWT_SECRET }}
          API_KEY_SECRET: ${{ secrets.API_KEY_SECRET }}
          DATABASE_PASSWORD: ${{ secrets.DATABASE_PASSWORD }}
          ADMIN_PASSWORD: ${{ secrets.ADMIN_PASSWORD }}
        run: |
          helm upgrade --install heimdall ./heimdall \
            --namespace heimdall \
            --create-namespace \
            --set heimdall.secrets.JWT_SECRET="${JWT_SECRET}" \
            --set heimdall.secrets.API_KEY_SECRET="${API_KEY_SECRET}" \
            --set heimdall.secrets.DATABASE_PASSWORD="${DATABASE_PASSWORD}" \
            --set heimdall.secrets.ADMIN_PASSWORD="${ADMIN_PASSWORD}"
```

## GitLab CI

```yaml
deploy:
  stage: deploy
  script:
    - |
      helm upgrade --install heimdall ./heimdall \
        --namespace heimdall \
        --create-namespace \
        --set heimdall.secrets.JWT_SECRET="${JWT_SECRET}" \
        --set heimdall.secrets.API_KEY_SECRET="${API_KEY_SECRET}" \
        --set heimdall.secrets.DATABASE_PASSWORD="${DATABASE_PASSWORD}" \
        --set heimdall.secrets.ADMIN_PASSWORD="${ADMIN_PASSWORD}"
  only:
    - main
```

**GitLab CI Variables**: Store secrets in **Settings** → **CI/CD** → **Variables** with:
- **Protected**: Yes
- **Masked**: Yes
- **Environment scope**: production

## CLI Deployment

```bash
# Read secrets from environment
export JWT_SECRET="$(openssl rand -hex 64)"
export API_KEY_SECRET="$(openssl rand -hex 33)"
export DATABASE_PASSWORD="$(openssl rand -hex 33)"
export ADMIN_PASSWORD="SecurePassword123!"

# Deploy with inline secrets
helm upgrade --install heimdall ./heimdall \
  --namespace heimdall \
  --create-namespace \
  --set heimdall.secrets.JWT_SECRET="${JWT_SECRET}" \
  --set heimdall.secrets.API_KEY_SECRET="${API_KEY_SECRET}" \
  --set heimdall.secrets.DATABASE_PASSWORD="${DATABASE_PASSWORD}" \
  --set heimdall.secrets.ADMIN_PASSWORD="${ADMIN_PASSWORD}"
```

## HashiCorp Vault Integration

```bash
# Fetch secrets from Vault
export JWT_SECRET="$(vault kv get -field=jwt_secret secret/heimdall/production)"
export API_KEY_SECRET="$(vault kv get -field=api_key_secret secret/heimdall/production)"
export DATABASE_PASSWORD="$(vault kv get -field=database_password secret/heimdall/production)"
export ADMIN_PASSWORD="$(vault kv get -field=admin_password secret/heimdall/production)"

# Deploy
helm upgrade --install heimdall ./heimdall \
  --namespace heimdall \
  --set heimdall.secrets.JWT_SECRET="${JWT_SECRET}" \
  --set heimdall.secrets.API_KEY_SECRET="${API_KEY_SECRET}" \
  --set heimdall.secrets.DATABASE_PASSWORD="${DATABASE_PASSWORD}" \
  --set heimdall.secrets.ADMIN_PASSWORD="${ADMIN_PASSWORD}"
```

## Security Considerations

::warning{title="CI/CD Security"}
- Use masked/protected variables in CI/CD
- Never echo secrets in CI/CD logs
- Rotate secrets regularly
- Use secret scanning tools (GitLeaks, TruffleHog)
::

### GitLab CI Security

- Set variables to **Protected** and **Masked**
- Limit to specific environments (production, staging)
- Use environment-specific scopes

### GitHub Actions Security

- Use GitHub Secrets (encrypted at rest)
- Never log secret values
- Use OIDC authentication where possible
- Limit to specific branches

## See Also

- [Secrets Overview](/helm-chart/getting-started/secrets/overview) - Choose the right approach
- [Existing Secret](/helm-chart/getting-started/secrets/existing-secret) - Production approach
- [File-based Secrets](/helm-chart/getting-started/secrets/file-based) - Development approach
