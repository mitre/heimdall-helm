---
title: Upgrade Guide
description: Upgrade Heimdall to the latest version
navigation:
  icon: i-lucide-arrow-up-circle
---

How to upgrade Heimdall Helm chart deployments safely.

## Before Upgrading

### 1. Check Current Version

```bash
helm list -n heimdall
```

### 2. Backup Database

```bash
# Export PostgreSQL data
kubectl exec -n heimdall heimdall-postgresql-0 -- pg_dumpall -U postgres > heimdall-backup.sql
```

### 3. Review Changes

Check the [CHANGELOG](https://github.com/mitre/heimdall-helm/blob/main/CHANGELOG.md) for breaking changes.

## Upgrade Process

### Standard Upgrade

```bash
# Update Helm repository
helm repo update mitre

# Check available versions
helm search repo mitre/heimdall --versions

# Upgrade to latest
helm upgrade heimdall mitre/heimdall \
  --namespace heimdall \
  --reuse-values \
  --wait
```

### Upgrade to Specific Version

```bash
helm upgrade heimdall mitre/heimdall \
  --namespace heimdall \
  --version 1.1.0 \
  --reuse-values \
  --wait
```

### Upgrade with New Values

```bash
# Preview changes
helm diff upgrade heimdall mitre/heimdall \
  --namespace heimdall \
  --values heimdall-production.yaml

# Apply upgrade
helm upgrade heimdall mitre/heimdall \
  --namespace heimdall \
  --values heimdall-production.yaml \
  --wait
```

## Verify Upgrade

```bash
# Check pod status
kubectl get pods -n heimdall -w

# Check Heimdall version
kubectl exec -n heimdall heimdall-0 -- cat /app/package.json | grep version

# Check application logs
kubectl logs -n heimdall heimdall-0 -f
```

## Rollback

If upgrade fails, rollback to previous version:

```bash
# View upgrade history
helm history heimdall -n heimdall

# Rollback to previous release
helm rollback heimdall -n heimdall

# Or rollback to specific revision
helm rollback heimdall 3 -n heimdall
```

## Version-Specific Upgrades

### Upgrading from v0.x to v1.x

v1.0.0 is a major rewrite with breaking changes:

**Breaking Changes:**
- Chart name changed: `heimdall2` â†’ `heimdall`
- Values structure changed
- Bitnami PostgreSQL subchart (replaces standalone PostgreSQL)
- Three-approach secrets management

**Migration Steps:**

1. **Export existing data:**

```bash
kubectl exec -n heimdall heimdall2-postgresql-0 -- \
  pg_dump -U postgres heimdall2 > heimdall-data.sql
```

2. **Uninstall old chart:**

```bash
helm uninstall heimdall2 -n heimdall
```

3. **Install v1.0.0 with new values:**

```yaml
# heimdall-v1.yaml
heimdall:
  existingSecret: "heimdall-production-secrets"

  ingress:
    enabled: true
    className: "traefik"  # Updated from ingressClassName
    hosts:
      - host: heimdall.example.com
        paths:
          - path: /
            pathType: Prefix

postgresql:
  enabled: true
  auth:
    database: heimdall
    username: postgres
```

```bash
helm install heimdall mitre/heimdall \
  --namespace heimdall \
  --values heimdall-v1.yaml \
  --wait
```

4. **Restore data:**

```bash
kubectl cp heimdall-data.sql heimdall/heimdall-postgresql-0:/tmp/
kubectl exec -n heimdall heimdall-postgresql-0 -- \
  psql -U postgres heimdall < /tmp/heimdall-data.sql
```

5. **Restart Heimdall:**

```bash
kubectl rollout restart statefulset/heimdall -n heimdall
```

## Database Migrations

Heimdall runs Sequelize migrations automatically on startup via init container.

**Check migration status:**

```bash
# View init container logs
kubectl logs -n heimdall heimdall-0 -c wait-for-db

# View application startup logs
kubectl logs -n heimdall heimdall-0 -f | grep -i migration
```

If migrations fail, check:
- Database connectivity
- Database user permissions
- Startup probe timeouts (increase if migrations take long)

## Common Issues

### Pod Stuck in Init

**Cause:** Database not ready or migrations failing

**Fix:**
```bash
kubectl logs -n heimdall heimdall-0 -c wait-for-db
kubectl describe pod -n heimdall heimdall-0
```

### Certificate Renewal Failed

**Cause:** cert-manager certificate expired during upgrade

**Fix:**
```bash
kubectl delete certificate -n heimdall heimdall-tls
# cert-manager will recreate
```

### Persistent Volume Claims Not Found

**Cause:** PVC names changed between versions

**Fix:**
```bash
# List PVCs
kubectl get pvc -n heimdall

# Manually patch StatefulSet to use old PVC names
kubectl edit statefulset/heimdall -n heimdall
```

## Best Practices

### Test in Staging First

Always upgrade staging environment before production:

```bash
# Staging upgrade
helm upgrade heimdall-staging mitre/heimdall \
  --namespace heimdall-staging \
  --values staging.yaml

# Validate staging
# Then upgrade production
```

### Use Canary Deployments

For critical deployments, use partitioned updates:

```yaml
heimdall:
  updateStrategy:
    type: RollingUpdate
    rollingUpdate:
      partition: 1  # Only update pod 1, keep pod 0 on old version
```

After validating pod 1:
```bash
helm upgrade heimdall mitre/heimdall \
  --set heimdall.updateStrategy.rollingUpdate.partition=0
```

### Monitor During Upgrade

```bash
# Watch pod status
kubectl get pods -n heimdall -w

# Monitor application logs
kubectl logs -n heimdall -l app.kubernetes.io/name=heimdall -f

# Check HPA scaling
kubectl get hpa -n heimdall -w
```

## See Also

- [Installation Guide](/getting-started/installation)
- [Database Migrations](/advanced/database-migrations)
- [High Availability](/advanced/availability/high-availability)
