---
title: TLS Troubleshooting
description: Common TLS issues and solutions
navigation:
  icon: i-lucide-wrench
---

Common TLS certificate issues and how to fix them.

## Certificate Not Applied

**Symptom**: HTTPS not working, browser shows insecure connection

### Check Ingress Configuration

```bash
kubectl get ingress -n heimdall -o yaml | grep -A5 tls
```

Should show:
```yaml
tls:
- hosts:
  - heimdall.example.com
  secretName: heimdall-tls
```

### Check Secret Exists

```bash
kubectl get secret heimdall-tls -n heimdall
```

If it doesn't exist, create it or check cert-manager logs.

### Check Secret Type

```bash
kubectl get secret heimdall-tls -n heimdall -o jsonpath='{.type}'
```

Must be: `kubernetes.io/tls`

### Check Secret Contents

```bash
kubectl get secret heimdall-tls -n heimdall -o yaml
```

Should have both `tls.crt` and `tls.key` in the `data` section.

### Common Causes

- Secret doesn't exist
- Secret name mismatch in values.yaml
- Secret wrong type (must be `kubernetes.io/tls`)
- Secret in wrong namespace

## cert-manager Certificate Pending

**Symptom**: Certificate stuck in "Pending" or "Issuing" state

### Check Certificate Status

```bash
kubectl describe certificate heimdall-tls -n heimdall
kubectl get certificaterequest -n heimdall
kubectl get challenge -n heimdall
```

### Check Challenge Type

For HTTP-01 challenges:

```bash
kubectl describe challenge -n heimdall
```

Look for errors in the `Events` section.

### Common Issues

**Ingress not routing `/.well-known/acme-challenge/`**:

Check if your ingress has path rules that block ACME challenges:

```bash
kubectl get ingress -n heimdall -o yaml
```

Make sure you don't have rules that prevent cert-manager from accessing `/.well-known/acme-challenge/`.

**DNS not pointing to ingress**:

```bash
nslookup heimdall.example.com
```

Should return your ingress controller's IP.

**Firewall blocking port 80**:

HTTP-01 challenge requires port 80 accessible from the internet. Check firewall rules.

**Rate limit hit**:

If you see "too many certificates already issued", you've hit Let's Encrypt's rate limit (50 certs/week per domain). Use staging issuer for testing:

```yaml
annotations:
  cert-manager.io/cluster-issuer: "letsencrypt-staging"
```

### Force Certificate Renewal

```bash
kubectl delete certificate heimdall-tls -n heimdall
kubectl delete secret heimdall-tls -n heimdall
# cert-manager will recreate automatically
```

## Browser Certificate Warnings

**Symptom**: "Your connection is not private" or certificate error in browser

### Check Certificate Matches Hostname

```bash
kubectl get secret heimdall-tls -n heimdall -o jsonpath='{.data.tls\.crt}' | \
  base64 -d | openssl x509 -noout -text | grep -A1 "Subject Alternative Name"
```

The hostname you're visiting must be in the SAN list.

### Check Certificate Not Expired

```bash
kubectl get secret heimdall-tls -n heimdall -o jsonpath='{.data.tls\.crt}' | \
  base64 -d | openssl x509 -noout -dates
```

Check the `notAfter` date.

### Check Full Certificate Chain

```bash
kubectl get secret heimdall-tls -n heimdall -o jsonpath='{.data.tls\.crt}' | \
  base64 -d | openssl crl2pkcs7 -nocrl -certfile /dev/stdin | \
  openssl pkcs7 -print_certs -noout
```

You should see server cert + intermediate(s) + root CA.

### Common Causes

- CN/SAN doesn't match hostname
- Certificate expired
- Missing intermediate certificates
- Using staging Let's Encrypt cert (expected - shows warning)
- Self-signed cert (expected in development)

## Let's Encrypt Rate Limits

**Symptom**: "too many certificates already issued for exact set of domains"

### Cause

Let's Encrypt limits:
- 50 certificates per week per registered domain
- 5 duplicate certificates per week

### Solution

Use staging issuer for testing:

```yaml
heimdall:
  ingress:
    annotations:
      cert-manager.io/cluster-issuer: "letsencrypt-staging"
```

After confirming it works, switch to production and delete staging certificate:

```bash
kubectl delete certificate heimdall-tls -n heimdall
kubectl delete secret heimdall-tls -n heimdall
```

Update to production issuer:

```yaml
heimdall:
  ingress:
    annotations:
      cert-manager.io/cluster-issuer: "letsencrypt-prod"
```

Upgrade:
```bash
helm upgrade heimdall ./heimdall -n heimdall -f values.yaml
```

## Private Key Encrypted

**Symptom**: Error creating secret: "error parsing private key"

### Cause

Private key is encrypted with a passphrase.

### Solution

Decrypt the private key:

```bash
openssl rsa -in encrypted.key -out decrypted.key
```

Enter the passphrase when prompted, then use `decrypted.key` to create the secret.

## Certificate Chain Issues

**Symptom**: Browser shows "unable to get local issuer certificate"

### Cause

Missing intermediate certificates in the chain.

### Solution

Combine server cert + intermediate(s) + root:

```bash
cat server.crt intermediate.crt root.crt > fullchain.crt
```

Then recreate the secret:

```bash
kubectl delete secret heimdall-tls -n heimdall
kubectl create secret tls heimdall-tls \
  --cert=fullchain.crt \
  --key=tls.key \
  -n heimdall
```

## Wrong Namespace

**Symptom**: Secret exists but ingress can't find it

### Check Namespaces Match

```bash
kubectl get secret heimdall-tls -n heimdall
kubectl get ingress -n heimdall
```

Both must be in the same namespace.

### Solution

Either:
1. Create secret in correct namespace
2. Update Helm chart to use correct namespace

## cert-manager Not Installed

**Symptom**: Certificate never gets created, no cert-manager pods

### Check cert-manager

```bash
kubectl get pods -n cert-manager
```

Should show 3 running pods.

### Solution

Install cert-manager:

```bash
kubectl apply -f https://github.com/cert-manager/cert-manager/releases/download/v1.13.0/cert-manager.yaml
```

## Ingress Controller Issues

**Symptom**: Certificate created but HTTPS still doesn't work

### Check Ingress Controller

```bash
kubectl get pods -n <ingress-namespace>
```

Make sure your ingress controller (Traefik, Nginx, etc.) is running.

### Check Ingress Class

```bash
kubectl get ingressclass
```

Make sure the `className` in your values.yaml matches an existing ingress class.

### Check Ingress Logs

```bash
kubectl logs -n <ingress-namespace> <ingress-pod-name>
```

Look for TLS-related errors.

## DNS-01 Challenge Failures

**Symptom**: Wildcard certificate challenge fails

### Check DNS Provider Credentials

```bash
kubectl get secret -n cert-manager <dns-credentials-secret>
```

Make sure the secret exists and has correct keys.

### Check DNS Provider Permissions

For Route53, IAM user needs:
- `route53:GetChange`
- `route53:ChangeResourceRecordSets`
- `route53:ListHostedZonesByName`

For CloudDNS, service account needs:
- `dns.changes.create`
- `dns.changes.get`
- `dns.resourceRecordSets.list`

### Check Challenge Records

```bash
kubectl describe challenge -n heimdall
```

Look for error messages about DNS record creation.

## See Also

- [TLS Overview](/helm-chart/configuration/tls/overview) - Choose the right TLS approach
- [Automated TLS](/helm-chart/configuration/tls/automated) - cert-manager setup
- [Manual TLS](/helm-chart/configuration/tls/manual) - Manual certificates
- [cert-manager Troubleshooting](https://cert-manager.io/docs/troubleshooting/) - Official troubleshooting guide
