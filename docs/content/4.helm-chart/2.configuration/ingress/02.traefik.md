---
title: Traefik Ingress Controller
description: Setup and configure Traefik for Heimdall
navigation:
  icon: i-lucide-shield-check
---

Traefik is the recommended ingress controller for Heimdall deployments.

## Why Traefik?

- ✅ Actively maintained by Traefik Labs
- ✅ Native Kubernetes integration
- ✅ Automatic HTTPS with Let's Encrypt
- ✅ Modern features (middleware, Gateway API support)
- ✅ Dynamic configuration updates
- ✅ Built-in observability (metrics, tracing)

## Installation

### 1. Add Traefik Helm Repository

```bash
helm repo add traefik https://traefik.github.io/charts
helm repo update
```

### 2. Install Traefik

```bash
helm install traefik traefik/traefik -n traefik --create-namespace
```

### 3. Verify Installation

```bash
kubectl get pods -n traefik
```

Expected output:
```
NAME                       READY   STATUS    RESTARTS   AGE
traefik-5d4f7cb5d9-x8k2m   1/1     Running   0          1m
```

## Basic Configuration

```yaml
heimdall:
  ingress:
    enabled: true
    className: "traefik"
    annotations:
      traefik.ingress.kubernetes.io/router.entrypoints: websecure
      cert-manager.io/cluster-issuer: "letsencrypt-prod"
    hosts:
      - host: heimdall.example.com
        paths:
          - path: /
            pathType: Prefix
    tls:
      - secretName: heimdall-tls
        hosts:
          - heimdall.example.com
```

## Common Annotations

### Force HTTPS

```yaml
annotations:
  # Route to HTTPS entrypoint only
  traefik.ingress.kubernetes.io/router.entrypoints: websecure

  # Enable TLS
  traefik.ingress.kubernetes.io/router.tls: "true"

  # Redirect HTTP → HTTPS (using middleware)
  traefik.ingress.kubernetes.io/router.middlewares: default-redirect-https@kubernetescrd
```

### Session Affinity (Sticky Sessions)

```yaml
annotations:
  # Enable sticky sessions with cookie
  traefik.ingress.kubernetes.io/service.sticky.cookie: "true"

  # Cookie name (optional)
  traefik.ingress.kubernetes.io/service.sticky.cookie.name: "heimdall-session"

  # Cookie security (httpOnly, secure, sameSite)
  traefik.ingress.kubernetes.io/service.sticky.cookie.httpOnly: "true"
  traefik.ingress.kubernetes.io/service.sticky.cookie.secure: "true"
```

### Timeout Settings

```yaml
annotations:
  # Request timeout (for large XCCDF uploads)
  traefik.ingress.kubernetes.io/router.timeout.request: "600s"

  # Idle timeout
  traefik.ingress.kubernetes.io/router.timeout.idle: "300s"
```

### Custom Middleware

```yaml
annotations:
  # Apply custom middleware (defined as separate resource)
  traefik.ingress.kubernetes.io/router.middlewares: |
    default-redirect-https@kubernetescrd,
    default-security-headers@kubernetescrd
```

## Middleware Examples

### Security Headers

Create a Middleware resource:

```yaml
apiVersion: traefik.containo.us/v1alpha1
kind: Middleware
metadata:
  name: security-headers
  namespace: default
spec:
  headers:
    customResponseHeaders:
      X-Frame-Options: "DENY"
      X-Content-Type-Options: "nosniff"
      Strict-Transport-Security: "max-age=31536000; includeSubDomains"
```

Apply it:
```bash
kubectl apply -f security-headers-middleware.yaml
```

Use in ingress:
```yaml
heimdall:
  ingress:
    annotations:
      traefik.ingress.kubernetes.io/router.middlewares: default-security-headers@kubernetescrd
```

### HTTPS Redirect

```yaml
apiVersion: traefik.containo.us/v1alpha1
kind: Middleware
metadata:
  name: redirect-https
  namespace: default
spec:
  redirectScheme:
    scheme: https
    permanent: true
```

## Complete Example

Full production configuration:

```yaml
heimdall:
  ingress:
    enabled: true
    className: "traefik"
    annotations:
      # cert-manager
      cert-manager.io/cluster-issuer: "letsencrypt-prod"

      # HTTPS only
      traefik.ingress.kubernetes.io/router.entrypoints: websecure
      traefik.ingress.kubernetes.io/router.tls: "true"

      # Timeouts (large XCCDF uploads)
      traefik.ingress.kubernetes.io/router.timeout.request: "600s"

      # Security headers
      traefik.ingress.kubernetes.io/router.middlewares: default-security-headers@kubernetescrd

      # Sticky sessions (if using multiple replicas)
      traefik.ingress.kubernetes.io/service.sticky.cookie: "true"
      traefik.ingress.kubernetes.io/service.sticky.cookie.secure: "true"
      traefik.ingress.kubernetes.io/service.sticky.cookie.httpOnly: "true"

    hosts:
      - host: heimdall.example.com
        paths:
          - path: /
            pathType: Prefix

    tls:
      - secretName: heimdall-tls
        hosts:
          - heimdall.example.com
```

## Advanced Configuration

### Rate Limiting

Create RateLimit middleware:

```yaml
apiVersion: traefik.containo.us/v1alpha1
kind: Middleware
metadata:
  name: rate-limit
  namespace: default
spec:
  rateLimit:
    average: 100
    burst: 50
```

Apply to ingress:
```yaml
annotations:
  traefik.ingress.kubernetes.io/router.middlewares: default-rate-limit@kubernetescrd
```

### IP Whitelist

Restrict access to specific IPs:

```yaml
apiVersion: traefik.containo.us/v1alpha1
kind: Middleware
metadata:
  name: ip-whitelist
  namespace: default
spec:
  ipWhiteList:
    sourceRange:
      - "192.168.1.0/24"
      - "10.0.0.0/8"
```

### Basic Auth

Add basic authentication:

```bash
# Create auth secret
htpasswd -c auth admin
kubectl create secret generic basic-auth --from-file=auth -n default
```

```yaml
apiVersion: traefik.containo.us/v1alpha1
kind: Middleware
metadata:
  name: basic-auth
  namespace: default
spec:
  basicAuth:
    secret: basic-auth
```

## Traefik Dashboard

Access Traefik dashboard for debugging:

```bash
kubectl port-forward -n traefik $(kubectl get pods -n traefik -l app.kubernetes.io/name=traefik -o name) 9000:9000
```

Open: http://localhost:9000/dashboard/

## Common Issues

### Ingress Not Accessible

Check Traefik service:
```bash
kubectl get svc -n traefik
```

Should show EXTERNAL-IP (LoadBalancer) or NodePort.

### Certificate Not Working

Check cert-manager:
```bash
kubectl get certificate -n heimdall
kubectl describe certificate heimdall-tls -n heimdall
```

### 404 Not Found

Check ingress rules:
```bash
kubectl describe ingress -n heimdall
```

Verify hostname matches and backend service exists.

## See Also

- [Ingress Overview](/helm-chart/configuration/ingress/overview) - Compare ingress controllers
- [TLS Configuration](/helm-chart/configuration/tls/overview) - HTTPS setup
- [Ingress Troubleshooting](/helm-chart/configuration/ingress/troubleshooting) - Common issues
- [Traefik Documentation](https://doc.traefik.io/traefik/) - Official docs
