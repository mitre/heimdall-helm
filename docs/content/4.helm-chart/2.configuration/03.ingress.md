---
title: Ingress Configuration
description: Configure ingress controllers for external access to Heimdall
---

## Overview

The Heimdall Helm chart supports industry-standard ingress configuration for exposing Heimdall to external traffic. The chart is controller-agnostic and works with Traefik, Nginx, Kong, and cloud load balancers.

## Quick Start

### Enable Ingress

```yaml
heimdall:
  ingress:
    enabled: true
    className: "traefik"  # or "nginx", "kong", etc.
    hosts:
      - host: heimdall.example.com
        paths:
          - path: /
            pathType: Prefix
```

### With TLS (HTTPS)

```yaml
heimdall:
  ingress:
    enabled: true
    className: "traefik"
    annotations:
      cert-manager.io/cluster-issuer: "letsencrypt-prod"
    hosts:
      - host: heimdall.example.com
        paths:
          - path: /
            pathType: Prefix
    tls:
      - secretName: heimdall-tls
        hosts:
          - heimdall.example.com
```

## Supported Ingress Controllers

### Traefik (Default - Recommended)

Traefik is the default ingress controller for this chart.

**Why Traefik?**
- ✅ Actively maintained by Traefik Labs
- ✅ Native Kubernetes integration
- ✅ Automatic HTTPS with Let's Encrypt
- ✅ Modern features (middleware, Gateway API)

**Basic Configuration**:

```yaml
heimdall:
  ingress:
    enabled: true
    className: "traefik"
    annotations:
      traefik.ingress.kubernetes.io/router.entrypoints: websecure
      cert-manager.io/cluster-issuer: "letsencrypt-prod"
    hosts:
      - host: heimdall.example.com
        paths:
          - path: /
            pathType: Prefix
    tls:
      - secretName: heimdall-tls
        hosts:
          - heimdall.example.com
```

**Common Traefik Annotations**:

```yaml
annotations:
  # Force HTTPS
  traefik.ingress.kubernetes.io/router.entrypoints: websecure
  traefik.ingress.kubernetes.io/router.tls: "true"

  # Session affinity (sticky sessions)
  traefik.ingress.kubernetes.io/service.sticky.cookie: "true"

  # Custom middleware
  traefik.ingress.kubernetes.io/router.middlewares: default-redirect-https@kubernetescrd
```

**Install Traefik**:

```bash
# Add Traefik Helm repository
helm repo add traefik https://traefik.github.io/charts
helm repo update

# Install Traefik
helm install traefik traefik/traefik -n traefik --create-namespace
```

### Nginx Ingress Controller

::callout{icon="i-heroicons-exclamation-triangle" color="amber"}
**Important**: The Nginx Ingress Controller project announced retirement in March 2026. Consider using Traefik for new deployments.
::

**Basic Configuration**:

```yaml
heimdall:
  ingress:
    enabled: true
    className: "nginx"
    annotations:
      nginx.ingress.kubernetes.io/ssl-redirect: "true"
      cert-manager.io/cluster-issuer: "letsencrypt-prod"
    hosts:
      - host: heimdall.example.com
        paths:
          - path: /
            pathType: Prefix
    tls:
      - secretName: heimdall-tls
        hosts:
          - heimdall.example.com
```

**Common Nginx Annotations**:

```yaml
annotations:
  # Increase upload size (for large XCCDF files)
  nginx.ingress.kubernetes.io/proxy-body-size: "100m"

  # Force HTTPS redirect
  nginx.ingress.kubernetes.io/ssl-redirect: "true"
  nginx.ingress.kubernetes.io/force-ssl-redirect: "true"

  # Timeout settings
  nginx.ingress.kubernetes.io/proxy-read-timeout: "600"
  nginx.ingress.kubernetes.io/proxy-send-timeout: "600"
```

**Install Nginx Ingress Controller**:

```bash
# Install using official manifests
kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/main/deploy/static/provider/cloud/deploy.yaml

# Or using Helm
helm install nginx-ingress ingress-nginx/ingress-nginx -n ingress-nginx --create-namespace
```

### Cloud Load Balancers

#### AWS ALB (Application Load Balancer)

```yaml
heimdall:
  ingress:
    enabled: true
    className: "alb"
    annotations:
      alb.ingress.kubernetes.io/scheme: internet-facing
      alb.ingress.kubernetes.io/target-type: ip
      alb.ingress.kubernetes.io/certificate-arn: arn:aws:acm:us-east-1:123456789012:certificate/abc123
      alb.ingress.kubernetes.io/listen-ports: '[{"HTTP": 80}, {"HTTPS": 443}]'
      alb.ingress.kubernetes.io/ssl-redirect: "443"
    hosts:
      - host: heimdall.example.com
        paths:
          - path: /
            pathType: Prefix
```

#### Google Cloud Load Balancer

```yaml
heimdall:
  ingress:
    enabled: true
    className: "gce"
    annotations:
      kubernetes.io/ingress.global-static-ip-name: "heimdall-ip"
      networking.gke.io/managed-certificates: "heimdall-cert"
    hosts:
      - host: heimdall.example.com
        paths:
          - path: /
            pathType: Prefix
```

#### Azure Application Gateway

```yaml
heimdall:
  ingress:
    enabled: true
    className: "azure/application-gateway"
    annotations:
      appgw.ingress.kubernetes.io/ssl-redirect: "true"
      appgw.ingress.kubernetes.io/backend-protocol: "http"
    hosts:
      - host: heimdall.example.com
        paths:
          - path: /
            pathType: Prefix
```

## TLS/HTTPS Configuration

### Option 1: cert-manager (Automated - Recommended)

cert-manager automatically provisions and renews TLS certificates.

**Install cert-manager**:

```bash
kubectl apply -f https://github.com/cert-manager/cert-manager/releases/download/v1.13.0/cert-manager.yaml
```

**Create ClusterIssuer** (Let's Encrypt):

```yaml
apiVersion: cert-manager.io/v1
kind: ClusterIssuer
metadata:
  name: letsencrypt-prod
spec:
  acme:
    server: https://acme-v02.api.letsencrypt.org/directory
    email: admin@example.com
    privateKeySecretRef:
      name: letsencrypt-prod
    solvers:
    - http01:
        ingress:
          class: traefik  # or nginx
```

**Configure Chart**:

```yaml
heimdall:
  ingress:
    enabled: true
    className: "traefik"
    annotations:
      cert-manager.io/cluster-issuer: "letsencrypt-prod"  # ← Key annotation
    hosts:
      - host: heimdall.example.com
        paths:
          - path: /
            pathType: Prefix
    tls:
      - secretName: heimdall-tls  # cert-manager creates this automatically
        hosts:
          - heimdall.example.com
```

cert-manager will:
1. Create a Certificate resource
2. Request certificate from Let's Encrypt
3. Create `heimdall-tls` secret
4. Automatically renew before expiration

**Verify Certificate**:

```bash
kubectl get certificate -n heimdall
kubectl describe certificate heimdall-tls -n heimdall
```

### Option 2: Manual Certificates (DoD/MITRE/Corporate)

For environments with existing certificates (DoD PKI, MITRE certs, corporate CA).

**Create TLS Secret**:

```bash
# From certificate files
kubectl create secret tls heimdall-tls \
  --cert=/path/to/tls.crt \
  --key=/path/to/tls.key \
  -n heimdall

# With certificate chain
kubectl create secret tls heimdall-tls \
  --cert=/path/to/fullchain.crt \
  --key=/path/to/tls.key \
  -n heimdall
```

**Configure Chart**:

```yaml
heimdall:
  ingress:
    enabled: true
    className: "traefik"
    hosts:
      - host: heimdall.mil.example
        paths:
          - path: /
            pathType: Prefix
    tls:
      - secretName: heimdall-tls  # Pre-created secret
        hosts:
          - heimdall.mil.example
```

**Certificate Renewal**:

Manual certificates require manual renewal. Set calendar reminders before expiration.

```bash
# Check certificate expiration
kubectl get secret heimdall-tls -n heimdall -o jsonpath='{.data.tls\.crt}' | \
  base64 -d | openssl x509 -noout -enddate

# Update certificate (before expiration)
kubectl delete secret heimdall-tls -n heimdall
kubectl create secret tls heimdall-tls \
  --cert=/path/to/new-cert.crt \
  --key=/path/to/new-key.key \
  -n heimdall
```

## Configuration Reference

### values.yaml Structure

```yaml
heimdall:
  ingress:
    # -- Enable ingress controller resource
    enabled: false

    # -- Ingress class name (traefik, nginx, kong, alb, gce, etc.)
    className: "traefik"

    # -- Custom annotations (controller-specific)
    annotations: {}

    # -- Ingress hosts with paths
    hosts:
      - host: heimdall.local
        paths:
          - path: /
            pathType: Prefix

    # -- TLS configuration
    tls: []
      # - secretName: heimdall-tls
      #   hosts:
      #     - heimdall.example.com
```

### Multiple Hosts

```yaml
heimdall:
  ingress:
    enabled: true
    className: "traefik"
    hosts:
      - host: heimdall.example.com
        paths:
          - path: /
            pathType: Prefix
      - host: heimdall.internal.com
        paths:
          - path: /
            pathType: Prefix
    tls:
      - secretName: heimdall-external-tls
        hosts:
          - heimdall.example.com
      - secretName: heimdall-internal-tls
        hosts:
          - heimdall.internal.com
```

## Troubleshooting

### Ingress Not Created

**Check if ingress is enabled**:

```bash
kubectl get ingress -n heimdall
```

If empty, verify `heimdall.ingress.enabled: true` in values.

### 404 Not Found

**Verify ingress rules**:

```bash
kubectl describe ingress -n heimdall
```

Check:
- Host matches your DNS
- Path is correct (`/`)
- Backend service exists: `kubectl get svc -n heimdall`

### TLS Certificate Issues

**Check certificate status** (cert-manager):

```bash
kubectl get certificate -n heimdall
kubectl describe certificate heimdall-tls -n heimdall
```

**Check secret exists**:

```bash
kubectl get secret heimdall-tls -n heimdall
```

**View certificate details**:

```bash
kubectl get secret heimdall-tls -n heimdall -o jsonpath='{.data.tls\.crt}' | \
  base64 -d | openssl x509 -text -noout
```

### Ingress Controller Not Installed

```bash
# Check for Traefik
kubectl get pods -n traefik

# Check for Nginx
kubectl get pods -n ingress-nginx

# Install if missing (see installation sections above)
```

## Common Scenarios

### Local Development (No Ingress)

```yaml
heimdall:
  ingress:
    enabled: false  # Use port-forward instead

# Access via:
# kubectl port-forward -n heimdall svc/heimdall 8080:3000
```

### Production (Traefik + Let's Encrypt)

```yaml
heimdall:
  ingress:
    enabled: true
    className: "traefik"
    annotations:
      cert-manager.io/cluster-issuer: "letsencrypt-prod"
      traefik.ingress.kubernetes.io/router.entrypoints: websecure
    hosts:
      - host: heimdall.example.com
        paths:
          - path: /
            pathType: Prefix
    tls:
      - secretName: heimdall-tls
        hosts:
          - heimdall.example.com
```

### DoD/Government (Manual Certs)

```yaml
heimdall:
  ingress:
    enabled: true
    className: "nginx"
    annotations:
      nginx.ingress.kubernetes.io/ssl-redirect: "true"
      nginx.ingress.kubernetes.io/proxy-body-size: "100m"
    hosts:
      - host: heimdall.navy.mil
        paths:
          - path: /
            pathType: Prefix
    tls:
      - secretName: dod-cert-secret  # Pre-created with DoD PKI cert
        hosts:
          - heimdall.navy.mil
```

## See Also

- [TLS/SSL Configuration](./9.tls.md) - Detailed TLS setup
- [Configuration Guide](./3.configuration.md) - General configuration
- [Database Setup](./6.database.md) - Database configuration
