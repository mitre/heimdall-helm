---
title: TLS/SSL Configuration
description: Configure HTTPS certificates for Heimdall
navigation:
  icon: i-lucide-lock
---

## Overview

Heimdall supports two approaches for TLS/SSL certificates:

::tabs

:::tabs-item{label="Automated (cert-manager)" icon="i-lucide-bot"}

## Automated Certificate Management

::tip{title="Recommended for Internet-Facing Deployments"}
cert-manager provides automatic certificate issuance and renewal from Let's Encrypt or other ACME providers.
::

### Benefits

- ✅ Automatic certificate issuance
- ✅ Automatic renewal (60 days before expiration)
- ✅ Supports Let's Encrypt, private CAs, Vault, Venafi
- ✅ No manual certificate management

### Prerequisites

- Ingress controller installed (Traefik, Nginx, etc.)
- Ingress enabled (`heimdall.ingress.enabled: true`)
- DNS configured to point to your ingress controller
- Port 80 accessible (for HTTP-01 challenge)

### Installation

::steps

#### Install cert-manager

```bash
kubectl apply -f https://github.com/cert-manager/cert-manager/releases/download/v1.13.0/cert-manager.yaml
```

#### Verify installation

```bash
kubectl get pods -n cert-manager
```

Expected output:
```
NAME                                      READY   STATUS    RESTARTS   AGE
cert-manager-5d7f97b46d-r8kzm            1/1     Running   0          1m
cert-manager-cainjector-69d885bf55-8tjr9 1/1     Running   0          1m
cert-manager-webhook-54754dcdfd-2q6qw    1/1     Running   0          1m
```

#### Create ClusterIssuer

::tip{title="Test with Staging First"}
Always use Let's Encrypt staging issuer first to avoid hitting production rate limits (50 certificates per registered domain per week).
::

**Staging Issuer** (for testing):

```yaml
apiVersion: cert-manager.io/v1
kind: ClusterIssuer
metadata:
  name: letsencrypt-staging
spec:
  acme:
    # Let's Encrypt staging server (relaxed rate limits)
    server: https://acme-staging-v02.api.letsencrypt.org/directory

    # Email for expiration notices
    email: admin@example.com

    # Secret to store ACME account private key
    privateKeySecretRef:
      name: letsencrypt-staging

    # HTTP-01 challenge solver
    solvers:
    - http01:
        ingress:
          class: traefik  # or nginx, alb, etc.
```

**Production Issuer** (after testing):

```yaml
apiVersion: cert-manager.io/v1
kind: ClusterIssuer
metadata:
  name: letsencrypt-prod
spec:
  acme:
    # Let's Encrypt production server
    server: https://acme-v02.api.letsencrypt.org/directory
    email: admin@example.com
    privateKeySecretRef:
      name: letsencrypt-prod
    solvers:
    - http01:
        ingress:
          class: traefik
```

Apply the ClusterIssuer:

```bash
kubectl apply -f clusterissuer.yaml
```

#### Configure Heimdall Chart

```yaml
heimdall:
  ingress:
    enabled: true
    className: "traefik"
    annotations:
      # Tell cert-manager to issue certificate
      cert-manager.io/cluster-issuer: "letsencrypt-staging"  # Use staging for testing

    hosts:
      - host: heimdall.example.com
        paths:
          - path: /
            pathType: Prefix

    tls:
      # cert-manager will create this secret automatically
      - secretName: heimdall-tls
        hosts:
          - heimdall.example.com
```

#### Deploy Chart

```bash
helm install heimdall ./heimdall -n heimdall --create-namespace -f values.yaml
```

What happens next:
1. cert-manager detects the `cert-manager.io/cluster-issuer` annotation
2. Creates a Certificate resource
3. Performs HTTP-01 challenge with Let's Encrypt
4. Stores certificate in `heimdall-tls` secret
5. Automatically renews 60 days before expiration

#### Verify Certificate

**Check Certificate resource**:

```bash
kubectl get certificate -n heimdall
```

Expected output:
```
NAME           READY   SECRET         AGE
heimdall-tls   True    heimdall-tls   5m
```

**Check certificate details**:

```bash
kubectl describe certificate heimdall-tls -n heimdall
```

**View certificate expiration**:

```bash
kubectl get secret heimdall-tls -n heimdall -o jsonpath='{.data.tls\.crt}' | \
  base64 -d | openssl x509 -noout -dates
```

#### Switch to Production

After verifying with staging issuer:

1. Update annotation to use production issuer:
   ```yaml
   annotations:
     cert-manager.io/cluster-issuer: "letsencrypt-prod"
   ```

2. Delete staging certificate to force renewal:
   ```bash
   kubectl delete certificate heimdall-tls -n heimdall
   kubectl delete secret heimdall-tls -n heimdall
   ```

3. cert-manager will automatically issue production certificate

::

### Wildcard Certificates (DNS-01 Challenge)

For wildcard certificates (e.g., `*.example.com`), use DNS-01 challenge instead of HTTP-01.

**Why DNS-01?** HTTP-01 challenge can't validate wildcard domains. DNS-01 validates domain ownership by creating a TXT record.

**Supported DNS Providers**:
- Route53 (AWS)
- CloudDNS (Google Cloud)
- Cloudflare
- Azure DNS
- DigitalOcean
- 30+ others

::code-group

```yaml [Route53 (AWS)]
apiVersion: cert-manager.io/v1
kind: ClusterIssuer
metadata:
  name: letsencrypt-dns-route53
spec:
  acme:
    server: https://acme-v02.api.letsencrypt.org/directory
    email: admin@example.com
    privateKeySecretRef:
      name: letsencrypt-dns
    solvers:
    - dns01:
        route53:
          region: us-east-1
          accessKeyID: AKIAIOSFODNN7EXAMPLE
          secretAccessKeySecretRef:
            name: route53-credentials
            key: secret-access-key
```

```yaml [CloudDNS (GCP)]
apiVersion: cert-manager.io/v1
kind: ClusterIssuer
metadata:
  name: letsencrypt-dns-clouddns
spec:
  acme:
    server: https://acme-v02.api.letsencrypt.org/directory
    email: admin@example.com
    privateKeySecretRef:
      name: letsencrypt-dns
    solvers:
    - dns01:
        cloudDNS:
          project: my-project
          serviceAccountSecretRef:
            name: clouddns-credentials
            key: key.json
```

```yaml [Cloudflare]
apiVersion: cert-manager.io/v1
kind: ClusterIssuer
metadata:
  name: letsencrypt-dns-cloudflare
spec:
  acme:
    server: https://acme-v02.api.letsencrypt.org/directory
    email: admin@example.com
    privateKeySecretRef:
      name: letsencrypt-dns
    solvers:
    - dns01:
        cloudflare:
          email: admin@example.com
          apiTokenSecretRef:
            name: cloudflare-api-token
            key: api-token
```

::

**Configure wildcard certificate**:

```yaml
heimdall:
  ingress:
    annotations:
      cert-manager.io/cluster-issuer: "letsencrypt-dns-route53"
    hosts:
      - host: heimdall.example.com
        paths:
          - path: /
    tls:
      - secretName: heimdall-wildcard-tls
        hosts:
          - "*.example.com"  # Wildcard domain
```

:::

:::tabs-item{label="Manual Certificates" icon="i-lucide-file-key"}

## Manual Certificate Management

::note{title="Use Cases"}
Manual certificates are required for:
- DoD PKI certificates
- MITRE corporate certificates
- Government CA certificates
- Purchased certificates (DigiCert, Comodo, etc.)
- Internal CA certificates
::

::warning{title="No Auto-Renewal"}
Manual certificates do not auto-renew. Set calendar reminders 30-60 days before expiration.
::

### Certificate Files Required

You need these files:
- **Certificate**: `tls.crt` (or `cert.pem`)
- **Private Key**: `tls.key` (or `key.pem`)
- **CA Bundle** (optional): `ca-bundle.crt`

::caution{title="Certificate Chain Required"}
If your certificate has intermediate CAs, you must combine them into a fullchain file. Missing intermediates cause browser warnings.
::

**Combine certificate chain**:

```bash
# Create fullchain (server cert + intermediate + root)
cat server.crt intermediate.crt root.crt > fullchain.crt
```

### Creating the TLS Secret

::code-group

```bash [From Files]
kubectl create secret tls heimdall-tls \
  --cert=fullchain.crt \
  --key=tls.key \
  -n heimdall
```

```yaml [From YAML]
apiVersion: v1
kind: Secret
metadata:
  name: heimdall-tls
  namespace: heimdall
type: kubernetes.io/tls
data:
  tls.crt: LS0tLS1CRUdJTi...  # Base64 encoded certificate
  tls.key: LS0tLS1CRUdJTi...  # Base64 encoded private key
```

```bash [Verify Secret]
kubectl get secret heimdall-tls -n heimdall
kubectl describe secret heimdall-tls -n heimdall
```

::

### Configuring Heimdall

```yaml
heimdall:
  ingress:
    enabled: true
    className: "traefik"
    hosts:
      - host: heimdall.example.com
        paths:
          - path: /
            pathType: Prefix
    tls:
      - secretName: heimdall-tls  # Pre-created secret
        hosts:
          - heimdall.example.com
```

### Deploying

```bash
helm install heimdall ./heimdall -n heimdall --create-namespace -f values.yaml
```

### Certificate Renewal

**Check expiration date**:

```bash
kubectl get secret heimdall-tls -n heimdall -o jsonpath='{.data.tls\.crt}' | \
  base64 -d | openssl x509 -noout -enddate
```

**Renew certificate** (before expiration):

```bash
# 1. Delete old secret
kubectl delete secret heimdall-tls -n heimdall

# 2. Create new secret with renewed certificate
kubectl create secret tls heimdall-tls \
  --cert=new-fullchain.crt \
  --key=new-key.key \
  -n heimdall

# 3. Restart pods to pick up new certificate (if needed)
kubectl rollout restart statefulset heimdall -n heimdall
```

### Certificate Sources

::accordion

:::accordion-item{icon="i-lucide-shield" label="DoD PKI Certificates"}

**Typical structure**:
- Server certificate: `server.cer`
- Private key: `server.key` (often encrypted)
- CA chain: `ca-bundle.cer`

**Decrypt private key** (if encrypted):

```bash
openssl rsa -in server.key.encrypted -out server.key
```

**Combine certificate chain**:

```bash
cat server.cer dod-intermediate-ca.cer dod-root-ca.cer > fullchain.crt
```

**Create secret**:

```bash
kubectl create secret tls heimdall-dod-tls \
  --cert=fullchain.crt \
  --key=server.key \
  -n heimdall
```

**Configure chart**:

```yaml
heimdall:
  ingress:
    enabled: true
    className: "nginx"
    annotations:
      nginx.ingress.kubernetes.io/ssl-redirect: "true"
      nginx.ingress.kubernetes.io/backend-protocol: "HTTP"
    hosts:
      - host: heimdall.navy.mil
        paths:
          - path: /
            pathType: Prefix
    tls:
      - secretName: heimdall-dod-tls
        hosts:
          - heimdall.navy.mil
```

:::

:::accordion-item{icon="i-lucide-building-2" label="MITRE Corporate Certificates"}

MITRE-issued certificates follow similar process:

```bash
# Combine certificate chain
cat mitre-server.crt mitre-intermediate.crt mitre-root.crt > fullchain.crt

# Create secret
kubectl create secret tls heimdall-mitre-tls \
  --cert=fullchain.crt \
  --key=mitre-key.key \
  -n heimdall
```

**Configure chart**:

```yaml
heimdall:
  ingress:
    enabled: true
    className: "traefik"
    hosts:
      - host: heimdall.mitre.org
        paths:
          - path: /
    tls:
      - secretName: heimdall-mitre-tls
        hosts:
          - heimdall.mitre.org
```

:::

:::accordion-item{icon="i-lucide-badge-check" label="Purchased Certificates (DigiCert, Comodo)"}

**Commercial certificates** from providers like DigiCert, Comodo, Sectigo.

**Files provided**:
- Your certificate: `your_domain.crt`
- Intermediate certificate: `intermediate.crt`
- Root certificate: `root.crt` (optional)

**Create fullchain**:

```bash
cat your_domain.crt intermediate.crt > fullchain.crt
```

**Create secret**:

```bash
kubectl create secret tls heimdall-commercial-tls \
  --cert=fullchain.crt \
  --key=private.key \
  -n heimdall
```

:::

:::accordion-item{icon="i-lucide-file-lock" label="Self-Signed Certificates (Development)"}

**Generate self-signed certificate** for local development:

```bash
openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
  -keyout tls.key -out tls.crt \
  -subj "/CN=heimdall.local/O=Development"
```

**Create secret**:

```bash
kubectl create secret tls heimdall-dev-tls \
  --cert=tls.crt \
  --key=tls.key \
  -n heimdall
```

**Configure chart**:

```yaml
heimdall:
  ingress:
    enabled: true
    hosts:
      - host: heimdall.local
        paths:
          - path: /
    tls:
      - secretName: heimdall-dev-tls
        hosts:
          - heimdall.local
```

::warning
Self-signed certificates will show browser warnings. Only use for development.
::

:::

::

:::

## Troubleshooting

::accordion

:::accordion-item{icon="i-lucide-alert-circle" label="Certificate Not Applied"}

**Symptom**: HTTPS not working, browser shows "Not Secure"

**Check ingress TLS configuration**:

```bash
kubectl get ingress -n heimdall -o yaml | grep -A5 tls
```

**Check secret exists**:

```bash
kubectl get secret heimdall-tls -n heimdall
```

**Check secret type**:

```bash
kubectl get secret heimdall-tls -n heimdall -o jsonpath='{.type}'
# Should output: kubernetes.io/tls
```

**Common issues**:
- Secret doesn't exist
- Secret name doesn't match `tls.secretName` in values
- Secret is not type `kubernetes.io/tls`
- Ingress not referencing secret correctly

:::

:::accordion-item{icon="i-lucide-clock" label="cert-manager Certificate Pending"}

**Symptom**: Certificate stuck in "Pending" or "Issuing" state

**Check Certificate resource**:

```bash
kubectl describe certificate heimdall-tls -n heimdall
```

Look for:
- `Issuing certificate as Secret does not exist`
- `Waiting for CertificateRequest`
- HTTP-01 challenge status

**Check CertificateRequest**:

```bash
kubectl get certificaterequest -n heimdall
kubectl describe certificaterequest <name> -n heimdall
```

**Check Challenge** (HTTP-01):

```bash
kubectl get challenge -n heimdall
kubectl describe challenge <name> -n heimdall
```

**Common issues**:
- Ingress controller not routing `/.well-known/acme-challenge/` correctly
- DNS not pointing to ingress controller
- Firewall blocking port 80 (required for HTTP-01)
- Wrong email address in ClusterIssuer
- Rate limit hit (use staging issuer for testing)

:::

:::accordion-item{icon="i-lucide-shield-alert" label="Browser Certificate Warnings"}

**Symptom**: "Your connection is not private" or "NET::ERR_CERT_AUTHORITY_INVALID"

**Check certificate matches hostname**:

```bash
kubectl get secret heimdall-tls -n heimdall -o jsonpath='{.data.tls\.crt}' | \
  base64 -d | openssl x509 -noout -text | grep -A1 "Subject Alternative Name"
```

Should show your hostname (e.g., `DNS:heimdall.example.com`)

**Check certificate is valid**:

```bash
kubectl get secret heimdall-tls -n heimdall -o jsonpath='{.data.tls\.crt}' | \
  base64 -d | openssl x509 -noout -dates
```

Verify:
- `notBefore` is in the past
- `notAfter` is in the future

**Check certificate chain**:

```bash
# Test certificate chain from outside cluster
openssl s_client -connect heimdall.example.com:443 -showcerts
```

**Common issues**:
- Certificate CN/SAN doesn't match hostname
- Certificate expired
- Missing intermediate certificates
- Using staging Let's Encrypt certificate (will show warning)
- Self-signed certificate (expected in development)

:::

:::accordion-item{icon="i-lucide-ban" label="Let's Encrypt Rate Limits"}

**Symptom**: cert-manager error "too many certificates already issued"

**Cause**: Let's Encrypt production rate limits:
- 50 certificates per registered domain per week
- 5 duplicate certificates per week

**Solution**: Use staging issuer for testing

```yaml
annotations:
  cert-manager.io/cluster-issuer: "letsencrypt-staging"  # Not prod
```

Staging certificates will show browser warnings but verify your setup works.

**Switch to production** after confirming:

1. Update annotation:
   ```yaml
   annotations:
     cert-manager.io/cluster-issuer: "letsencrypt-prod"
   ```

2. Delete staging certificate:
   ```bash
   kubectl delete certificate heimdall-tls -n heimdall
   kubectl delete secret heimdall-tls -n heimdall
   ```

3. cert-manager issues production certificate

:::

::

## Common Scenarios

::accordion

:::accordion-item{icon="i-lucide-flask-conical" label="Local Development"}

**Goal**: Test Heimdall with HTTPS in local cluster (kind, minikube)

**Solution**: Self-signed certificate

```bash
# Generate self-signed certificate
openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
  -keyout tls.key -out tls.crt \
  -subj "/CN=heimdall.local/O=Development"

# Create secret
kubectl create secret tls heimdall-dev-tls \
  --cert=tls.crt --key=tls.key -n heimdall
```

**values.yaml**:

```yaml
heimdall:
  ingress:
    enabled: true
    hosts:
      - host: heimdall.local
        paths:
          - path: /
    tls:
      - secretName: heimdall-dev-tls
        hosts:
          - heimdall.local
```

**Access**: Add `127.0.0.1 heimdall.local` to `/etc/hosts`

Browser will show warnings for self-signed certificate (expected).

:::

:::accordion-item{icon="i-lucide-globe" label="Production Internet-Facing"}

**Goal**: Public Heimdall instance with automatic HTTPS

**Solution**: cert-manager with Let's Encrypt

**Prerequisites**:
- cert-manager installed
- DNS pointing to ingress controller
- Port 80 accessible for HTTP-01 challenge

**values.yaml**:

```yaml
heimdall:
  ingress:
    enabled: true
    className: "traefik"
    annotations:
      cert-manager.io/cluster-issuer: "letsencrypt-prod"
      traefik.ingress.kubernetes.io/router.entrypoints: websecure
    hosts:
      - host: heimdall.example.com
        paths:
          - path: /
            pathType: Prefix
    tls:
      - secretName: heimdall-tls
        hosts:
          - heimdall.example.com
```

cert-manager handles everything:
- Certificate issuance
- Automatic renewal (every 60 days)
- Challenge validation

:::

:::accordion-item{icon="i-lucide-building" label="Production Internal (Corporate CA)"}

**Goal**: Internal Heimdall with corporate CA certificate

**Solution**: Pre-created TLS secret with corporate certificate

**Create secret**:

```bash
kubectl create secret tls heimdall-corp-tls \
  --cert=fullchain.crt \
  --key=private.key \
  -n heimdall
```

**values.yaml**:

```yaml
heimdall:
  ingress:
    enabled: true
    className: "nginx"
    annotations:
      nginx.ingress.kubernetes.io/ssl-redirect: "true"
    hosts:
      - host: heimdall.internal.corp
        paths:
          - path: /
            pathType: Prefix
    tls:
      - secretName: heimdall-corp-tls
        hosts:
          - heimdall.internal.corp
```

::warning{title="Renewal Required"}
Corporate CA certificates typically expire annually. Set reminders to renew before expiration.
::

:::

:::accordion-item{icon="i-lucide-shield-check" label="DoD/Government (PKI)"}

**Goal**: Deploy Heimdall with DoD PKI certificate

**Solution**: Manual certificate with DoD root CA chain

**Prepare certificate**:

```bash
# Decrypt private key (if encrypted)
openssl rsa -in server.key.encrypted -out server.key

# Combine chain
cat server.cer dod-intermediate-ca.cer dod-root-ca.cer > fullchain.crt

# Create secret
kubectl create secret tls heimdall-dod-tls \
  --cert=fullchain.crt \
  --key=server.key \
  -n heimdall
```

**values.yaml**:

```yaml
heimdall:
  ingress:
    enabled: true
    className: "nginx"
    annotations:
      nginx.ingress.kubernetes.io/ssl-redirect: "true"
    hosts:
      - host: heimdall.navy.mil
        paths:
          - path: /
            pathType: Prefix
    tls:
      - secretName: heimdall-dod-tls
        hosts:
          - heimdall.navy.mil
```

**Additional**: Configure custom CA certificates (see [Custom CA Certificates](/helm-chart/configuration/custom-ca-certificates))

:::

::

## See Also

- [Ingress Configuration](/helm-chart/configuration/ingress) - Ingress controller setup
- [Custom CA Certificates](/helm-chart/configuration/custom-ca-certificates) - Trust custom CAs
- [cert-manager Documentation](https://cert-manager.io/docs/) - Official cert-manager docs
- [Let's Encrypt Rate Limits](https://letsencrypt.org/docs/rate-limits/) - Production limits
