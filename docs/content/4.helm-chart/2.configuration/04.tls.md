---
title: TLS/SSL Configuration
description: Configure HTTPS certificates for Heimdall
navigation:
  icon: i-lucide-lock
---

## Overview

Heimdall supports two approaches for TLS/SSL certificates:
- **Automated** - cert-manager with Let's Encrypt (recommended for internet-facing deployments)
- **Manual** - Existing certificates (DoD PKI, MITRE certs, corporate CA, purchased certificates)

## Quick Start

::code-group

```yaml [Automated (cert-manager)]
heimdall:
  ingress:
    enabled: true
    className: "traefik"
    annotations:
      cert-manager.io/cluster-issuer: "letsencrypt-prod"
    hosts:
      - host: heimdall.example.com
        paths:
          - path: /
    tls:
      - secretName: heimdall-tls  # Created automatically
        hosts:
          - heimdall.example.com
```

```yaml [Manual Certificates]
# First create secret:
# kubectl create secret tls heimdall-tls \
#   --cert=fullchain.crt --key=tls.key -n heimdall

heimdall:
  ingress:
    enabled: true
    className: "nginx"
    hosts:
      - host: heimdall.mil.example
        paths:
          - path: /
    tls:
      - secretName: heimdall-tls  # Pre-created
        hosts:
          - heimdall.mil.example
```

::

## Choosing Your Approach

::tabs

:::tabs-item{label="When to Use Automated" icon="i-lucide-bot"}

### cert-manager (Automated)

**Use when:**
- ✅ Internet-facing deployment
- ✅ Public DNS accessible
- ✅ Port 80 accessible for HTTP-01 challenge
- ✅ Want automatic renewal
- ✅ Using Let's Encrypt or ACME provider

**Benefits:**
- Zero manual certificate management
- Automatic renewal (60 days before expiration)
- Free certificates from Let's Encrypt
- Supports DNS-01 for wildcard certificates

**Not suitable for:**
- ❌ Air-gapped environments
- ❌ DoD/Government PKI requirements
- ❌ Corporate CA requirements

:::

:::tabs-item{label="When to Use Manual" icon="i-lucide-file-key"}

### Manual Certificates

**Use when:**
- ✅ DoD PKI certificates required
- ✅ Corporate CA certificates
- ✅ Internal/private deployments
- ✅ Air-gapped environments
- ✅ Purchased certificates (DigiCert, Comodo)

**Requirements:**
- Manual certificate renewal
- Certificate files (cert + key)
- Certificate chain (intermediates + root)

**Not suitable for:**
- ❌ Public internet deployments (use cert-manager instead)
- ❌ Frequent certificate rotation

:::

::

## Setup Instructions

::tabs

:::tabs-item{label="Automated Setup" icon="i-lucide-bot"}

### cert-manager Installation

::steps

#### Install cert-manager

```bash
kubectl apply -f https://github.com/cert-manager/cert-manager/releases/download/v1.13.0/cert-manager.yaml
```

#### Verify installation

```bash
kubectl get pods -n cert-manager
```

Expected: 3 running pods (cert-manager, cainjector, webhook)

#### Create ClusterIssuer

::tip{title="Test with Staging First"}
Use staging issuer first to avoid Let's Encrypt rate limits (50 certs/week).
::

**Staging** (for testing):

```yaml
apiVersion: cert-manager.io/v1
kind: ClusterIssuer
metadata:
  name: letsencrypt-staging
spec:
  acme:
    server: https://acme-staging-v02.api.letsencrypt.org/directory
    email: admin@example.com
    privateKeySecretRef:
      name: letsencrypt-staging
    solvers:
    - http01:
        ingress:
          class: traefik
```

**Production** (after testing):

```yaml
apiVersion: cert-manager.io/v1
kind: ClusterIssuer
metadata:
  name: letsencrypt-prod
spec:
  acme:
    server: https://acme-v02.api.letsencrypt.org/directory
    email: admin@example.com
    privateKeySecretRef:
      name: letsencrypt-prod
    solvers:
    - http01:
        ingress:
          class: traefik
```

Apply:
```bash
kubectl apply -f clusterissuer.yaml
```

#### Configure Heimdall

```yaml
heimdall:
  ingress:
    enabled: true
    className: "traefik"
    annotations:
      cert-manager.io/cluster-issuer: "letsencrypt-staging"
    hosts:
      - host: heimdall.example.com
        paths:
          - path: /
    tls:
      - secretName: heimdall-tls
        hosts:
          - heimdall.example.com
```

#### Deploy and verify

```bash
# Deploy
helm install heimdall ./heimdall -n heimdall --create-namespace -f values.yaml

# Check certificate
kubectl get certificate -n heimdall
# Should show: READY=True
```

#### Switch to production

After verifying staging works:

```yaml
annotations:
  cert-manager.io/cluster-issuer: "letsencrypt-prod"  # Change to prod
```

Delete staging cert to force renewal:
```bash
kubectl delete certificate heimdall-tls -n heimdall
kubectl delete secret heimdall-tls -n heimdall
```

### Wildcard Certificates (DNS-01)

For wildcard domains (`*.example.com`), use DNS-01 challenge:

::code-group

```yaml [Route53 (AWS)]
apiVersion: cert-manager.io/v1
kind: ClusterIssuer
metadata:
  name: letsencrypt-dns
spec:
  acme:
    server: https://acme-v02.api.letsencrypt.org/directory
    email: admin@example.com
    privateKeySecretRef:
      name: letsencrypt-dns
    solvers:
    - dns01:
        route53:
          region: us-east-1
          accessKeyID: AKIAIOSFODNN7EXAMPLE
          secretAccessKeySecretRef:
            name: route53-credentials
            key: secret-access-key
```

```yaml [CloudDNS (GCP)]
apiVersion: cert-manager.io/v1
kind: ClusterIssuer
metadata:
  name: letsencrypt-dns
spec:
  acme:
    server: https://acme-v02.api.letsencrypt.org/directory
    email: admin@example.com
    privateKeySecretRef:
      name: letsencrypt-dns
    solvers:
    - dns01:
        cloudDNS:
          project: my-project
          serviceAccountSecretRef:
            name: clouddns-credentials
            key: key.json
```

```yaml [Cloudflare]
apiVersion: cert-manager.io/v1
kind: ClusterIssuer
metadata:
  name: letsencrypt-dns
spec:
  acme:
    server: https://acme-v02.api.letsencrypt.org/directory
    email: admin@example.com
    privateKeySecretRef:
      name: letsencrypt-dns
    solvers:
    - dns01:
        cloudflare:
          email: admin@example.com
          apiTokenSecretRef:
            name: cloudflare-api-token
            key: api-token
```

::

:::

:::tabs-item{label="Manual Setup" icon="i-lucide-file-key"}

### Manual Certificate Setup

::steps

#### Prepare certificate files

You need:
- Certificate: `tls.crt` (or `cert.pem`)
- Private Key: `tls.key` (or `key.pem`)
- CA Bundle (optional): `ca-bundle.crt`

::caution{title="Certificate Chain Required"}
If your cert has intermediates, combine them: `cat server.crt intermediate.crt root.crt > fullchain.crt`
::

#### Create TLS secret

::code-group

```bash [From Files]
kubectl create secret tls heimdall-tls \
  --cert=fullchain.crt \
  --key=tls.key \
  -n heimdall
```

```bash [From YAML]
kubectl apply -f - <<EOF
apiVersion: v1
kind: Secret
metadata:
  name: heimdall-tls
  namespace: heimdall
type: kubernetes.io/tls
data:
  tls.crt: $(cat fullchain.crt | base64 -w0)
  tls.key: $(cat tls.key | base64 -w0)
EOF
```

::

#### Configure Heimdall

```yaml
heimdall:
  ingress:
    enabled: true
    className: "traefik"
    hosts:
      - host: heimdall.example.com
        paths:
          - path: /
    tls:
      - secretName: heimdall-tls
        hosts:
          - heimdall.example.com
```

#### Deploy

```bash
helm install heimdall ./heimdall -n heimdall --create-namespace -f values.yaml
```

### Certificate Sources

::accordion

:::accordion-item{icon="i-lucide-shield" label="DoD PKI Certificates"}

```bash
# Decrypt private key (if encrypted)
openssl rsa -in server.key.encrypted -out server.key

# Combine chain
cat server.cer dod-intermediate-ca.cer dod-root-ca.cer > fullchain.crt

# Create secret
kubectl create secret tls heimdall-dod-tls \
  --cert=fullchain.crt \
  --key=server.key \
  -n heimdall
```

:::

:::accordion-item{icon="i-lucide-building-2" label="Corporate CA Certificates"}

```bash
cat mitre-server.crt mitre-intermediate.crt mitre-root.crt > fullchain.crt

kubectl create secret tls heimdall-corp-tls \
  --cert=fullchain.crt \
  --key=mitre-key.key \
  -n heimdall
```

:::

:::accordion-item{icon="i-lucide-badge-check" label="Purchased Certificates (DigiCert, Comodo)"}

```bash
cat your_domain.crt intermediate.crt > fullchain.crt

kubectl create secret tls heimdall-commercial-tls \
  --cert=fullchain.crt \
  --key=private.key \
  -n heimdall
```

:::

:::accordion-item{icon="i-lucide-file-lock" label="Self-Signed (Development)"}

```bash
openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
  -keyout tls.key -out tls.crt \
  -subj "/CN=heimdall.local/O=Development"

kubectl create secret tls heimdall-dev-tls \
  --cert=tls.crt \
  --key=tls.key \
  -n heimdall
```

::warning
Self-signed certificates show browser warnings. Only for development.
::

:::

::

### Certificate Renewal

::warning{title="Manual Renewal Required"}
Manual certificates do NOT auto-renew. Set reminders 30-60 days before expiration.
::

**Check expiration**:

```bash
kubectl get secret heimdall-tls -n heimdall -o jsonpath='{.data.tls\.crt}' | \
  base64 -d | openssl x509 -noout -enddate
```

**Renew certificate**:

```bash
# 1. Delete old secret
kubectl delete secret heimdall-tls -n heimdall

# 2. Create new secret with renewed cert
kubectl create secret tls heimdall-tls \
  --cert=new-fullchain.crt \
  --key=new-key.key \
  -n heimdall

# 3. Restart pods (if needed)
kubectl rollout restart statefulset heimdall -n heimdall
```

:::

::

## Prerequisites

### For Automated (cert-manager)

- Ingress controller installed (Traefik, Nginx, etc.)
- Ingress enabled in Heimdall chart
- DNS pointing to ingress controller
- Port 80 accessible (for HTTP-01 challenge)
- Or DNS provider credentials (for DNS-01 wildcard certs)

### For Manual Certificates

- Certificate files (cert + key + chain)
- Certificate matches hostname (CN or SAN)
- Certificate not expired
- Private key unencrypted (or decrypt first)

## Troubleshooting

::accordion

:::accordion-item{icon="i-lucide-alert-circle" label="Certificate Not Applied"}

**Symptom**: HTTPS not working

**Check ingress**:
```bash
kubectl get ingress -n heimdall -o yaml | grep -A5 tls
```

**Check secret exists**:
```bash
kubectl get secret heimdall-tls -n heimdall
kubectl get secret heimdall-tls -n heimdall -o jsonpath='{.type}'
# Should be: kubernetes.io/tls
```

**Common issues**:
- Secret doesn't exist
- Secret name mismatch in values
- Secret wrong type

:::

:::accordion-item{icon="i-lucide-clock" label="cert-manager Certificate Pending"}

**Symptom**: Certificate stuck in "Pending" or "Issuing"

**Check status**:
```bash
kubectl describe certificate heimdall-tls -n heimdall
kubectl get certificaterequest -n heimdall
kubectl get challenge -n heimdall
```

**Common issues**:
- Ingress not routing `/.well-known/acme-challenge/`
- DNS not pointing to ingress
- Firewall blocking port 80
- Rate limit hit (use staging issuer)

:::

:::accordion-item{icon="i-lucide-shield-alert" label="Browser Certificate Warnings"}

**Symptom**: "Your connection is not private"

**Check certificate**:
```bash
# Check SAN matches hostname
kubectl get secret heimdall-tls -n heimdall -o jsonpath='{.data.tls\.crt}' | \
  base64 -d | openssl x509 -noout -text | grep -A1 "Subject Alternative Name"

# Check expiration
kubectl get secret heimdall-tls -n heimdall -o jsonpath='{.data.tls\.crt}' | \
  base64 -d | openssl x509 -noout -dates
```

**Common issues**:
- CN/SAN doesn't match hostname
- Certificate expired
- Missing intermediate certificates
- Using staging Let's Encrypt cert (expected)
- Self-signed cert (expected in dev)

:::

:::accordion-item{icon="i-lucide-ban" label="Let's Encrypt Rate Limits"}

**Symptom**: "too many certificates already issued"

**Cause**: Let's Encrypt limits (50 certs/week per domain)

**Solution**: Use staging issuer for testing

```yaml
annotations:
  cert-manager.io/cluster-issuer: "letsencrypt-staging"
```

After confirming it works, switch to production and delete staging cert.

:::

::

## Common Scenarios

::accordion

:::accordion-item{icon="i-lucide-flask-conical" label="Local Development"}

**Self-signed certificate for local testing**:

```bash
# Generate cert
openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
  -keyout tls.key -out tls.crt \
  -subj "/CN=heimdall.local/O=Development"

# Create secret
kubectl create secret tls heimdall-dev-tls \
  --cert=tls.crt --key=tls.key -n heimdall
```

```yaml
heimdall:
  ingress:
    enabled: true
    hosts:
      - host: heimdall.local
    tls:
      - secretName: heimdall-dev-tls
        hosts:
          - heimdall.local
```

Add to `/etc/hosts`: `127.0.0.1 heimdall.local`

:::

:::accordion-item{icon="i-lucide-globe" label="Production Internet-Facing"}

**cert-manager with Let's Encrypt**:

```yaml
heimdall:
  ingress:
    enabled: true
    className: "traefik"
    annotations:
      cert-manager.io/cluster-issuer: "letsencrypt-prod"
      traefik.ingress.kubernetes.io/router.entrypoints: websecure
    hosts:
      - host: heimdall.example.com
        paths:
          - path: /
    tls:
      - secretName: heimdall-tls
        hosts:
          - heimdall.example.com
```

**Prerequisites**:
- cert-manager installed
- DNS pointing to ingress
- Port 80 accessible

:::

:::accordion-item{icon="i-lucide-building" label="Production Internal (Corporate CA)"}

**Pre-created TLS secret with corporate certificate**:

```bash
kubectl create secret tls heimdall-corp-tls \
  --cert=fullchain.crt \
  --key=private.key \
  -n heimdall
```

```yaml
heimdall:
  ingress:
    enabled: true
    className: "nginx"
    annotations:
      nginx.ingress.kubernetes.io/ssl-redirect: "true"
    hosts:
      - host: heimdall.internal.corp
        paths:
          - path: /
    tls:
      - secretName: heimdall-corp-tls
        hosts:
          - heimdall.internal.corp
```

::warning{title="Renewal Required"}
Corporate certs expire annually. Set reminders.
::

:::

:::accordion-item{icon="i-lucide-shield-check" label="DoD/Government (PKI)"}

**DoD PKI certificate with full chain**:

```bash
# Decrypt key
openssl rsa -in server.key.encrypted -out server.key

# Combine chain
cat server.cer dod-intermediate-ca.cer dod-root-ca.cer > fullchain.crt

# Create secret
kubectl create secret tls heimdall-dod-tls \
  --cert=fullchain.crt \
  --key=server.key \
  -n heimdall
```

```yaml
heimdall:
  ingress:
    enabled: true
    className: "nginx"
    annotations:
      nginx.ingress.kubernetes.io/ssl-redirect: "true"
    hosts:
      - host: heimdall.navy.mil
        paths:
          - path: /
    tls:
      - secretName: heimdall-dod-tls
        hosts:
          - heimdall.navy.mil
```

**Additional**: Configure custom CA trust (see [Custom CA Certificates](/helm-chart/configuration/custom-ca-certificates))

:::

::

## See Also

- [Ingress Configuration](/helm-chart/configuration/ingress) - Ingress controller setup
- [Custom CA Certificates](/helm-chart/configuration/custom-ca-certificates) - Trust custom CAs
- [cert-manager Documentation](https://cert-manager.io/docs/) - Official cert-manager docs
- [Let's Encrypt Rate Limits](https://letsencrypt.org/docs/rate-limits/) - Production limits
