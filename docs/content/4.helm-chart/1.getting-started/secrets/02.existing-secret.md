---
title: Existing Secret (Production)
description: Use external secret management for production deployments
navigation:
  icon: i-lucide-vault
---

::tip{title="Recommended for Production"}
Use this approach with external secret management tools for automated secret injection.
::

## Use Cases

- **External Secrets Operator** (ESO)
- **Sealed Secrets**
- **HashiCorp Vault**
- **Cloud provider secret managers**:
  - AWS Secrets Manager
  - GCP Secret Manager
  - Azure Key Vault

## Configuration

```yaml
heimdall:
  existingSecret: "heimdall-production-secrets"
```

## Required Secret Keys

The external secret must contain these four keys:

- `JWT_SECRET` - JWT signing secret (128 characters recommended)
- `API_KEY_SECRET` - API key encryption secret (66 characters recommended)
- `DATABASE_PASSWORD` - Database password (66 characters recommended)
- `ADMIN_PASSWORD` - Initial admin user password

## Manual Secret Creation

If not using an external secret manager, create the secret manually:

```bash
kubectl create secret generic heimdall-production-secrets \
  --namespace heimdall \
  --from-literal=JWT_SECRET="$(openssl rand -hex 64)" \
  --from-literal=API_KEY_SECRET="$(openssl rand -hex 33)" \
  --from-literal=DATABASE_PASSWORD="$(openssl rand -hex 33)" \
  --from-literal=ADMIN_PASSWORD="SecurePassword123!"
```

Verify secret:
```bash
kubectl get secret heimdall-production-secrets -n heimdall
kubectl describe secret heimdall-production-secrets -n heimdall
```

## External Secrets Operator (ESO)

### AWS Secrets Manager

```yaml
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: heimdall-secrets
  namespace: heimdall
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: aws-secrets-manager
    kind: ClusterSecretStore
  target:
    name: heimdall-production-secrets
    creationPolicy: Owner
  data:
    - secretKey: JWT_SECRET
      remoteRef:
        key: heimdall/production
        property: jwt_secret
    - secretKey: API_KEY_SECRET
      remoteRef:
        key: heimdall/production
        property: api_key_secret
    - secretKey: DATABASE_PASSWORD
      remoteRef:
        key: heimdall/production
        property: database_password
    - secretKey: ADMIN_PASSWORD
      remoteRef:
        key: heimdall/production
        property: admin_password
```

### GCP Secret Manager

```yaml
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: heimdall-secrets
  namespace: heimdall
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: gcp-secret-manager
    kind: ClusterSecretStore
  target:
    name: heimdall-production-secrets
    creationPolicy: Owner
  data:
    - secretKey: JWT_SECRET
      remoteRef:
        key: heimdall-jwt-secret
    - secretKey: API_KEY_SECRET
      remoteRef:
        key: heimdall-api-key-secret
    - secretKey: DATABASE_PASSWORD
      remoteRef:
        key: heimdall-database-password
    - secretKey: ADMIN_PASSWORD
      remoteRef:
        key: heimdall-admin-password
```

### Azure Key Vault

```yaml
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: heimdall-secrets
  namespace: heimdall
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: azure-key-vault
    kind: ClusterSecretStore
  target:
    name: heimdall-production-secrets
    creationPolicy: Owner
  data:
    - secretKey: JWT_SECRET
      remoteRef:
        key: heimdall-jwt-secret
    - secretKey: API_KEY_SECRET
      remoteRef:
        key: heimdall-api-key-secret
    - secretKey: DATABASE_PASSWORD
      remoteRef:
        key: heimdall-database-password
    - secretKey: ADMIN_PASSWORD
      remoteRef:
        key: heimdall-admin-password
```

## HashiCorp Vault

### Vault Agent Injector

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: heimdall-with-vault
  annotations:
    vault.hashicorp.com/agent-inject: "true"
    vault.hashicorp.com/role: "heimdall"
    vault.hashicorp.com/agent-inject-secret-secrets: "secret/data/heimdall/production"
```

### Manual Vault Integration

```bash
# Fetch secrets from Vault
export JWT_SECRET="$(vault kv get -field=jwt_secret secret/heimdall/production)"
export API_KEY_SECRET="$(vault kv get -field=api_key_secret secret/heimdall/production)"
export DATABASE_PASSWORD="$(vault kv get -field=database_password secret/heimdall/production)"
export ADMIN_PASSWORD="$(vault kv get -field=admin_password secret/heimdall/production)"

# Create Kubernetes secret
kubectl create secret generic heimdall-production-secrets \
  --namespace heimdall \
  --from-literal=JWT_SECRET="${JWT_SECRET}" \
  --from-literal=API_KEY_SECRET="${API_KEY_SECRET}" \
  --from-literal=DATABASE_PASSWORD="${DATABASE_PASSWORD}" \
  --from-literal=ADMIN_PASSWORD="${ADMIN_PASSWORD}"
```

## Sealed Secrets

Encrypt secrets for safe storage in git:

```bash
# Install Sealed Secrets controller
kubectl apply -f https://github.com/bitnami-labs/sealed-secrets/releases/download/v0.24.0/controller.yaml

# Create regular secret
kubectl create secret generic heimdall-secrets \
  --namespace heimdall \
  --from-literal=JWT_SECRET="$(openssl rand -hex 64)" \
  --from-literal=API_KEY_SECRET="$(openssl rand -hex 33)" \
  --from-literal=DATABASE_PASSWORD="$(openssl rand -hex 33)" \
  --from-literal=ADMIN_PASSWORD="SecurePassword123!" \
  --dry-run=client -o yaml > heimdall-secret.yaml

# Seal the secret
kubeseal -f heimdall-secret.yaml -w heimdall-sealed-secret.yaml

# Commit sealed secret to git (safe)
git add heimdall-sealed-secret.yaml
git commit -m "Add sealed Heimdall secrets"

# Apply sealed secret
kubectl apply -f heimdall-sealed-secret.yaml
```

## Secret Rotation

### Update Secret

```bash
kubectl delete secret heimdall-production-secrets -n heimdall

kubectl create secret generic heimdall-production-secrets \
  --namespace heimdall \
  --from-literal=JWT_SECRET="$(openssl rand -hex 64)" \
  --from-literal=API_KEY_SECRET="$(openssl rand -hex 33)" \
  --from-literal=DATABASE_PASSWORD="$(openssl rand -hex 33)" \
  --from-literal=ADMIN_PASSWORD="NewSecurePassword!"
```

### Restart Heimdall

```bash
kubectl rollout restart statefulset heimdall -n heimdall
```

## Verification

```bash
# Verify secret exists
kubectl get secret -n heimdall | grep heimdall

# Check secret keys (values are redacted)
kubectl describe secret heimdall-production-secrets -n heimdall
```

::warning{title="Create Secret Before Helm Install"}
For production deployments, create secrets **before** running `helm install`. The chart will reference the existing secret instead of creating a new one.
::

## See Also

- [Secrets Overview](/helm-chart/getting-started/secrets/overview) - Choose the right approach
- [File-based Secrets](/helm-chart/getting-started/secrets/file-based) - Development approach
- [Inline Secrets](/helm-chart/getting-started/secrets/inline) - CI/CD approach
