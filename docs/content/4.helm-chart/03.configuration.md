---
title: Configuration
description: Environment variables and configuration management for the Heimdall Helm chart
navigation:
  icon: i-lucide-settings
---

The Heimdall Helm chart separates **non-sensitive configuration** (ConfigMap) from **sensitive credentials** (Secret) following Kubernetes best practices.

## Configuration Loading Strategy

The chart uses a layered approach for environment variables:

1. **File-based defaults** from `env/heimdallconfig.yaml`
2. **Inline overrides** from `values.yaml`
3. **Auto-constructed values** (like `EXTERNAL_URL` from ingress)

::tip
This pattern follows the Vulcan Helm chart and Kubernetes `envFrom` best practices.
::

## ConfigMap Template

The chart loads environment variables using `envFrom` instead of individual `env` entries:

```yaml [templates/heimdall-statefulset.yaml]
envFrom:
  - configMapRef:
      name: {{ include "heimdall.fullname" . }}-config
  - secretRef:
      name: {{ ternary .Values.heimdall.existingSecret ... }}
```

::note
This approach reduced the StatefulSet template from **482 lines to 168 lines** (65% reduction).
::

## Environment Variable Categories

### Database Configuration

Non-sensitive database connection details:

::field-group
  ::field{name="DATABASE_HOST" type="string"}
  Database hostname (auto-configured for embedded PostgreSQL)
  ::
  ::field{name="DATABASE_PORT" type="string"}
  Database port (default: `5432`)
  ::
  ::field{name="DATABASE_NAME" type="string"}
  Database name (default: `heimdall`)
  ::
  ::field{name="DATABASE_USERNAME" type="string"}
  Database username (default: `postgres`)
  ::
  ::field{name="DATABASE_SSL" type="string"}
  Enable SSL connection (default: `false`)
  ::
::

::warning
`DATABASE_PASSWORD` is stored in Secret, not ConfigMap.
::

### JWT and Session Configuration

::field-group
  ::field{name="JWT_EXPIRE_TIME" type="string"}
  JWT token expiration (default: `25m`)
  ::
  ::field{name="ONE_SESSION_PER_USER" type="string"}
  Limit users to one concurrent session (default: `false`)
  ::
::

### Admin User Configuration

::field-group
  ::field{name="ADMIN_EMAIL" type="string"}
  Initial admin user email (default: `admin@heimdall.local`)
  ::
  ::field{name="ADMIN_USES_EXTERNAL_AUTH" type="string"}
  Admin uses external authentication (default: `false`)
  ::
::

### Authentication Configuration

::field-group
  ::field{name="LOCAL_LOGIN_DISABLED" type="string"}
  Disable local username/password login (default: `false`)
  ::
  ::field{name="REGISTRATION_DISABLED" type="string"}
  Disable new user registration (default: `false`)
  ::
::

### LDAP Configuration

::field-group
  ::field{name="LDAP_ENABLED" type="string"}
  Enable LDAP authentication (default: `false`)
  ::
  ::field{name="LDAP_HOST" type="string"}
  LDAP server hostname
  ::
  ::field{name="LDAP_PORT" type="string"}
  LDAP server port (default: `389`)
  ::
  ::field{name="LDAP_SSL" type="string"}
  Use SSL for LDAP (default: `false`)
  ::
::

### OAuth Providers

GitHub OAuth:

::field-group
  ::field{name="GITHUB_CLIENT_ID" type="string"}
  GitHub OAuth application client ID
  ::
  ::field{name="GITHUB_ENTERPRISE_INSTANCE_BASE_URL" type="string"}
  GitHub Enterprise base URL (default: `https://github.com`)
  ::
::

GitLab OAuth:

::field-group
  ::field{name="GITLAB_CLIENT_ID" type="string"}
  GitLab OAuth application client ID
  ::
  ::field{name="GITLAB_BASE_URL" type="string"}
  GitLab instance URL (default: `https://gitlab.com`)
  ::
::

### OIDC Configuration

::field-group
  ::field{name="OIDC_NAME" type="string"}
  OIDC provider display name
  ::
  ::field{name="OIDC_ISSUER" type="string"}
  OIDC issuer URL (e.g., `https://auth.example.com`)
  ::
  ::field{name="OIDC_USES_VERIFIED_EMAIL" type="string"}
  Require verified email (default: `true`)
  ::
::

### Okta Configuration

::field-group
  ::field{name="OKTA_DOMAIN" type="string"}
  Okta domain (e.g., `company.okta.com`)
  ::
  ::field{name="OKTA_CLIENT_ID" type="string"}
  Okta application client ID
  ::
::

## Overriding Configuration

### File-based Configuration

Edit `heimdall/env/heimdallconfig.yaml`:

```yaml [heimdall/env/heimdallconfig.yaml]
NODE_ENV: "production"
DATABASE_NAME: "heimdall"
DATABASE_USERNAME: "postgres"
DATABASE_PORT: "5432"
JWT_EXPIRE_TIME: "25m"
ADMIN_EMAIL: "admin@heimdall.local"
LOCAL_LOGIN_DISABLED: "false"
REGISTRATION_DISABLED: "false"
```

### Inline Overrides

Override via `values.yaml`:

```yaml [values.yaml]
heimdall:
  config:
    NODE_ENV: "production"
    JWT_EXPIRE_TIME: "1h"
    REGISTRATION_DISABLED: "true"
    LDAP_ENABLED: "true"
    LDAP_HOST: "ldap.example.com"
```

### CLI Overrides

Override during installation:

```bash [Terminal]
helm install heimdall ./heimdall \
  --namespace heimdall \
  --set heimdall.config.REGISTRATION_DISABLED=true \
  --set heimdall.config.LDAP_ENABLED=true \
  --set heimdall.config.LDAP_HOST=ldap.example.com
```

## Auto-Constructed Values

### EXTERNAL_URL

The chart automatically constructs `EXTERNAL_URL` from ingress configuration:

```yaml [templates/configmap.yaml]
{{- if and .Values.heimdall.ingress.enabled (index .Values.heimdall.ingress.hosts 0) }}
{{- $host := (index .Values.heimdall.ingress.hosts 0).host }}
{{- $scheme := "https" }}
EXTERNAL_URL: {{ printf "%s://%s" $scheme $host | quote }}
{{- end }}
```

Example result:

```yaml
EXTERNAL_URL: "https://heimdall.example.com"
```

::note
`EXTERNAL_URL` is used for OAuth/OIDC callback URLs. If ingress is disabled, you must set it manually via `heimdall.config.EXTERNAL_URL`.
::

## ConfigMap Template Structure

The ConfigMap template follows this pattern:

```yaml [templates/configmap.yaml]
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "heimdall.fullname" . }}-config
data:
  # 1. Database helpers (from _helpers.tpl)
  DATABASE_HOST: {{ include "heimdall.databaseHost" . | quote }}
  DATABASE_PORT: {{ include "heimdall.databasePort" . | quote }}

  # 2. Load from file
{{ range .Files.Lines "env/heimdallconfig.yaml" }}
  {{ . }}
{{ end }}

  # 3. Inline overrides
  {{- if .Values.heimdall.config }}
  {{- range $key, $val := .Values.heimdall.config }}
  {{ $key }}: {{ $val | quote }}
  {{- end }}
  {{- end }}

  # 4. Auto-constructed values
  EXTERNAL_URL: {{ printf "%s://%s" $scheme $host | quote }}
```

## Database Abstraction Helpers

The chart includes helper functions in `_helpers.tpl` to abstract embedded vs external database:

```yaml [templates/_helpers.tpl]
{{- define "heimdall.databaseHost" -}}
{{- if .Values.postgresql.enabled -}}
{{ include "postgresql.v1.primary.fullname" .Subcharts.postgresql }}
{{- else -}}
{{ .Values.externalDatabase.host }}
{{- end -}}
{{- end -}}
```

These helpers allow seamless switching between deployment modes:

- **Embedded PostgreSQL**: `heimdall-postgresql` (Bitnami subchart)
- **External database**: User-specified hostname

## Next Steps

::card-group
  ::card{icon="i-lucide-database" title="Database Setup" to="/helm-chart/database"}
  Configure PostgreSQL and migrations
  ::
  ::card{icon="i-lucide-key" title="Secrets Management" to="/helm-chart/secrets"}
  Manage sensitive credentials
  ::
::
