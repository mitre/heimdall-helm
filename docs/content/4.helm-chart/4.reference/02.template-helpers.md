---
title: Template Helpers
description: Reusable template functions for database abstraction and resource naming
navigation:
  icon: i-lucide-code
---

The Heimdall Helm chart uses **template helpers** in `_helpers.tpl` to provide reusable functions, abstract complexity, and maintain consistency across templates.

## What are Template Helpers?

Template helpers are **named template definitions** that can be included in other templates:

```yaml [templates/_helpers.tpl]
{{- define "heimdall.fullname" -}}
{{- if .Values.fullnameOverride }}
{{- .Values.fullnameOverride | trunc 63 | trimSuffix "-" }}
{{- else }}
{{- printf "%s-%s" .Release.Name .Chart.Name | trunc 63 | trimSuffix "-" }}
{{- end }}
{{- end }}
```

Usage in templates:

```yaml [templates/heimdall-service.yaml]
metadata:
  name: {{ include "heimdall.fullname" . }}
```

## Database Abstraction Helpers

The most important helpers abstract **embedded vs external database** configuration.

### Database Host

Returns the correct database hostname based on deployment mode:

```yaml [templates/_helpers.tpl]
{{- define "heimdall.databaseHost" -}}
{{- if .Values.postgresql.enabled }}
{{- include "heimdall.postgresql.fullname" . }}
{{- else }}
{{- required "externalDatabase.host is required when postgresql.enabled=false" .Values.externalDatabase.host }}
{{- end }}
{{- end }}
```

**Embedded PostgreSQL** (default):
- Returns: `heimdall-postgresql` (Bitnami subchart service name)
- Uses helper: `heimdall.postgresql.fullname`

**External database**:
- Returns: User-specified hostname (e.g., `db.example.com`)
- Requires: `externalDatabase.host` value (fails template if missing)

### Database Port

Returns the correct database port:

```yaml [templates/_helpers.tpl]
{{- define "heimdall.databasePort" -}}
{{- if .Values.postgresql.enabled }}
{{- .Values.postgresql.primary.service.ports.postgresql | default 5432 }}
{{- else }}
{{- .Values.externalDatabase.port | default 5432 }}
{{- end }}
{{- end }}
```

**Embedded PostgreSQL**:
- Returns: Configurable port from `postgresql.primary.service.ports.postgresql`
- Default: `5432`

**External database**:
- Returns: Port from `externalDatabase.port`
- Default: `5432`

### Database Name

Returns the database name:

```yaml [templates/_helpers.tpl]
{{- define "heimdall.databaseName" -}}
{{- if .Values.postgresql.enabled }}
{{- .Values.postgresql.auth.database }}
{{- else }}
{{- .Values.externalDatabase.database }}
{{- end }}
{{- end }}
```

**Embedded PostgreSQL**:
- Returns: Database name from Bitnami's `postgresql.auth.database`

**External database**:
- Returns: Database name from `externalDatabase.database`

### Database Username

Returns the database username:

```yaml [templates/_helpers.tpl]
{{- define "heimdall.databaseUsername" -}}
{{- if .Values.postgresql.enabled }}
{{- .Values.postgresql.auth.username | default "postgres" }}
{{- else }}
{{- .Values.externalDatabase.username }}
{{- end }}
{{- end }}
```

**Embedded PostgreSQL**:
- Returns: Username from Bitnami's `postgresql.auth.username`
- Default: `postgres`

**External database**:
- Returns: Username from `externalDatabase.username`

### Database Secret Name

Returns the Kubernetes secret name containing database credentials:

```yaml [templates/_helpers.tpl]
{{- define "heimdall.databaseSecretName" -}}
{{- if .Values.postgresql.enabled }}
  {{- if .Values.postgresql.auth.existingSecret }}
{{- .Values.postgresql.auth.existingSecret }}
  {{- else }}
{{- include "heimdall.postgresql.fullname" . }}
  {{- end }}
{{- else }}
  {{- if .Values.externalDatabase.existingSecret }}
{{- .Values.externalDatabase.existingSecret }}
  {{- else }}
{{- include "heimdall.fullname" . }}-secrets
  {{- end }}
{{- end }}
{{- end }}
```

**Priority Logic**:
1. **Embedded PostgreSQL with existing secret**: `postgresql.auth.existingSecret`
2. **Embedded PostgreSQL (default)**: Bitnami's auto-generated secret
3. **External DB with existing secret**: `externalDatabase.existingSecret`
4. **External DB (default)**: Heimdall's chart-managed secret

### Database Secret Key

Returns the key name within the database credentials secret:

```yaml [templates/_helpers.tpl]
{{- define "heimdall.databaseSecretKey" -}}
{{- if .Values.postgresql.enabled }}
{{- print "postgres-password" }}
{{- else }}
{{- print "DATABASE_PASSWORD" }}
{{- end }}
{{- end }}
```

**Key Names**:
- **Embedded PostgreSQL**: `postgres-password` (Bitnami standard)
- **External database**: `DATABASE_PASSWORD` (Heimdall standard)

### Database URL

Constructs the full PostgreSQL connection string:

```yaml [templates/_helpers.tpl]
{{- define "heimdall.databaseURL" -}}
{{- printf "postgresql://%s:$(DATABASE_PASSWORD)@%s:%s/%s"
    (include "heimdall.databaseUsername" .)
    (include "heimdall.databaseHost" .)
    (include "heimdall.databasePort" . | toString)
    (include "heimdall.databaseName" .) }}
{{- end }}
```

**Format**: `postgresql://username:$(DATABASE_PASSWORD)@host:port/database`

**Note**: Password uses `$(DATABASE_PASSWORD)` for runtime environment variable substitution.

## Usage in ConfigMap

The ConfigMap uses database helpers for **non-sensitive connection details**:

```yaml [templates/configmap.yaml]
data:
  DATABASE_HOST: {{ include "heimdall.databaseHost" . | quote }}
  DATABASE_PORT: {{ include "heimdall.databasePort" . | quote }}
  DATABASE_NAME: {{ include "heimdall.databaseName" . | quote }}
  DATABASE_USERNAME: {{ include "heimdall.databaseUsername" . | quote }}
```

## Naming Helpers

### Full Name

Generate full resource name with override support:

```yaml
{{- define "heimdall.fullname" -}}
{{- if .Values.fullnameOverride }}
{{- .Values.fullnameOverride | trunc 63 | trimSuffix "-" }}
{{- else }}
{{- printf "%s-%s" .Release.Name .Chart.Name | trunc 63 | trimSuffix "-" }}
{{- end }}
{{- end }}
```

**Example**:
- Release: `my-heimdall`
- Chart: `heimdall`
- Result: `my-heimdall-heimdall`

### Chart Name

Return chart name with override:

```yaml
{{- define "heimdall.name" -}}
{{- default .Chart.Name .Values.nameOverride | trunc 63 | trimSuffix "-" }}
{{- end }}
```

### Chart Label

Generate chart version label:

```yaml
{{- define "heimdall.chart" -}}
{{- printf "%s-%s" .Chart.Name .Chart.Version | replace "+" "_" | trunc 63 | trimSuffix "-" }}
{{- end }}
```

Result: `heimdall-1.0.0`

## Label Helpers

### Standard Labels

Generate standard Kubernetes labels:

```yaml
{{- define "heimdall.labels" -}}
helm.sh/chart: {{ include "heimdall.chart" . }}
{{ include "heimdall.selectorLabels" . }}
{{- if .Chart.AppVersion }}
app.kubernetes.io/version: {{ .Chart.AppVersion | quote }}
{{- end }}
app.kubernetes.io/managed-by: {{ .Release.Service }}
{{- end }}
```

### Selector Labels

Generate minimal labels for selectors:

```yaml
{{- define "heimdall.selectorLabels" -}}
app.kubernetes.io/name: {{ include "heimdall.name" . }}
app.kubernetes.io/instance: {{ .Release.Name }}
{{- end }}
```

::note
Selector labels are **immutable** in Deployments/StatefulSets. Keep them minimal to allow label changes without resource recreation.
::

## ServiceAccount Helper

Generate ServiceAccount name:

```yaml
{{- define "heimdall.serviceAccountName" -}}
{{- if .Values.heimdall.serviceAccount.create }}
{{- default (include "heimdall.fullname" .) .Values.heimdall.serviceAccount.name }}
{{- else }}
{{- default "default" .Values.heimdall.serviceAccount.name }}
{{- end }}
{{- end }}
```

## Helper Best Practices

### 1. Abstract Complexity

Instead of repeating complex logic:

```yaml
# ❌ Repeated logic in multiple templates
{{- if .Values.postgresql.enabled -}}
{{ include "postgresql.v1.primary.fullname" .Subcharts.postgresql }}
{{- else -}}
{{ .Values.externalDatabase.host }}
{{- end -}}
```

Use a helper:

```yaml
# ✅ Single source of truth
{{ include "heimdall.databaseHost" . }}
```

### 2. Maintain Consistency

Helpers ensure consistent naming across resources:

```yaml
# All resources use the same naming pattern
name: {{ include "heimdall.fullname" . }}
```

### 3. Enable Override

Support user customization via values:

```yaml
{{- define "heimdall.fullname" -}}
{{- if .Values.fullnameOverride }}
{{- .Values.fullnameOverride | trunc 63 | trimSuffix "-" }}
{{- else }}
{{- /* default logic */ -}}
{{- end }}
{{- end }}
```

### 4. Quote Appropriately

Always quote helper results in YAML:

```yaml
# ✅ Correct - Quoted
DATABASE_HOST: {{ include "heimdall.databaseHost" . | quote }}

# ❌ Wrong - Unquoted (may break on special characters)
DATABASE_HOST: {{ include "heimdall.databaseHost" . }}
```

## Testing Helpers

Test helper output using `helm template`:

```bash [Terminal]
# Show only ConfigMap to test database helpers
helm template heimdall ./heimdall \
  --show-only templates/configmap.yaml
```

Test with external database:

```bash [Terminal]
helm template heimdall ./heimdall \
  --set postgresql.enabled=false \
  --set externalDatabase.host=db.example.com \
  --show-only templates/configmap.yaml
```

## Example: Database Helpers in Action

### Embedded PostgreSQL (Default)

```yaml [values.yaml]
postgresql:
  enabled: true

databaseName: heimdall
databaseUsername: postgres
```

**Helper results**:
- `heimdall.databaseHost` → `heimdall-postgresql`
- `heimdall.databasePort` → `5432`
- `heimdall.databaseName` → `heimdall`
- `heimdall.databaseUsername` → `postgres`

### External Database

```yaml [values.yaml]
postgresql:
  enabled: false

externalDatabase:
  host: heimdall-db.abc123.us-east-1.rds.amazonaws.com
  port: 5432
  database: heimdall_production
  username: heimdall_app
```

**Helper results**:
- `heimdall.databaseHost` → `heimdall-db.abc123.us-east-1.rds.amazonaws.com`
- `heimdall.databasePort` → `5432`
- `heimdall.databaseName` → `heimdall_production`
- `heimdall.databaseUsername` → `heimdall_app`

## Next Steps

::card-group
  ::card{icon="i-lucide-database" title="Database Setup" to="/helm-chart/getting-started/database"}
  Configure PostgreSQL and migrations
  ::
  ::card{icon="i-lucide-file-json" title="Values Schema" to="/helm-chart/reference/values-schema"}
  JSON Schema validation
  ::
::
