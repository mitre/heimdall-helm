---
title: Secrets Management
description: Three flexible approaches for managing sensitive credentials in the Heimdall Helm chart
navigation:
  icon: i-lucide-key
---

The Heimdall Helm chart supports **three distinct approaches** for managing sensitive credentials, designed for different deployment scenarios.

::note
Priority order: `existingSecret` > `secrets` > `secretsFiles`
::

## Approach 1: Existing Secret (Production)

Use this approach with external secret management tools like:
- **External Secrets Operator** (ESO)
- **Sealed Secrets**
- **HashiCorp Vault**
- **Cloud provider secret managers** (AWS Secrets Manager, GCP Secret Manager, Azure Key Vault)

### Configuration

```yaml [values.yaml]
heimdall:
  existingSecret: "heimdall-production-secrets"
```

### Required Secret Keys

The external secret must contain these keys:

::field-group
  ::field{name="JWT_SECRET" type="string" required}
  JWT signing secret (128 characters recommended)
  ::
  ::field{name="API_KEY_SECRET" type="string" required}
  API key encryption secret (66 characters recommended)
  ::
  ::field{name="DATABASE_PASSWORD" type="string" required}
  Database password (66 characters recommended)
  ::
  ::field{name="ADMIN_PASSWORD" type="string" required}
  Initial admin user password
  ::
::

### Example: Creating Secret Manually

```bash [create-secret.sh]
kubectl create secret generic heimdall-production-secrets \
  --namespace heimdall \
  --from-literal=JWT_SECRET="$(openssl rand -hex 64)" \
  --from-literal=API_KEY_SECRET="$(openssl rand -hex 33)" \
  --from-literal=DATABASE_PASSWORD="$(openssl rand -hex 33)" \
  --from-literal=ADMIN_PASSWORD="SecurePassword123!"
```

::tip
For production deployments, create secrets **before** running `helm install`. The chart will reference the existing secret instead of creating a new one.
::

## Approach 2: File-based Secrets (Development)

**Default approach** for local development and testing. Secrets are loaded from gitignored files.

### Configuration

```yaml [values.yaml]
heimdall:
  secretsFiles: ["env/heimdall-secrets.yaml"]
```

### Generate Secrets

Use the provided script to generate cryptographically secure secrets:

```bash [Terminal]
./generate-heimdall-secrets.sh
```

This creates `heimdall/env/heimdall-secrets.yaml` with:

```yaml [heimdall/env/heimdall-secrets.yaml]
JWT_SECRET: "randomly-generated-128-chars"
API_KEY_SECRET: "randomly-generated-66-chars"
DATABASE_PASSWORD: "randomly-generated-66-chars"
ADMIN_PASSWORD: "Admin_randomly-generated"
```

::warning
The secrets file is automatically gitignored and created with `0600` permissions (owner read/write only).
::

### How It Works

The Helm chart reads the file during template rendering:

```yaml [templates/heimdall-secrets.yaml]
{{- if .Values.heimdall.secretsFiles }}
  {{- range $path := .Values.heimdall.secretsFiles }}
    {{- $fileContent := $.Files.Get $path }}
    {{- /* Parse and inject secrets */ -}}
  {{- end }}
{{- end }}
```

## Approach 3: Inline Secrets (CI/CD)

Use this approach for automated deployments where secrets are injected from environment variables or vault CLI.

### Configuration

```yaml [values.yaml]
heimdall:
  secrets:
    JWT_SECRET: "your-secret-key-128-chars"
    API_KEY_SECRET: "your-api-key-secret-66-chars"
    DATABASE_PASSWORD: "your-db-password"
    ADMIN_PASSWORD: "your-admin-password"
```

### CI/CD Example

```bash [deploy.sh]
helm upgrade --install heimdall ./heimdall \
  --namespace heimdall \
  --create-namespace \
  --set heimdall.secrets.JWT_SECRET="${JWT_SECRET}" \
  --set heimdall.secrets.API_KEY_SECRET="${API_KEY_SECRET}" \
  --set heimdall.secrets.DATABASE_PASSWORD="${DATABASE_PASSWORD}" \
  --set heimdall.secrets.ADMIN_PASSWORD="${ADMIN_PASSWORD}"
```

::caution
Ensure secrets are passed securely. Never hardcode secrets in files or commit them to version control.
::

## Security Best Practices

### Secret Generation

Use cryptographically secure random generators:

```bash [Terminal]
# JWT secret (128 characters)
openssl rand -hex 64

# API key secret (66 characters)
openssl rand -hex 33

# Database password (66 characters)
openssl rand -hex 33
```

### File Permissions

If using file-based secrets, ensure restrictive permissions:

```bash [Terminal]
chmod 600 heimdall/env/heimdall-secrets.yaml
```

### Gitignore Patterns

The chart includes proper gitignore patterns:

```gitignore [.gitignore]
# Secrets files (never commit these)
heimdall/env/heimdall-secrets.yaml
heimdall2/env/heimdall-secrets.yaml

# Templates are NOT ignored
# heimdall/templates/heimdall-secrets.yaml is committed
```

## Template Implementation

The chart uses `stringData` for cleaner secret handling:

```yaml [templates/heimdall-secrets.yaml]
{{- if not .Values.heimdall.existingSecret }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "heimdall.fullname" . }}-secrets
type: Opaque
stringData:
  {{- /* Priority: secrets > secretsFiles */ -}}
  {{- if .Values.heimdall.secrets }}
    {{- range $key, $val := .Values.heimdall.secrets }}
  {{ $key }}: {{ $val | quote }}
    {{- end }}
  {{- else if .Values.heimdall.secretsFiles }}
    {{- /* Load from files */ -}}
  {{- end }}
{{- end }}
```

::tip
Using `stringData` instead of `data` with base64 encoding makes templates more readable and easier to debug.
::

## Next Steps

::card-group
  ::card{icon="i-lucide-database" title="Database Configuration" to="/helm-chart/database"}
  Configure PostgreSQL connection and migrations
  ::
  ::card{icon="i-lucide-settings" title="Environment Variables" to="/helm-chart/configuration"}
  Non-sensitive configuration options
  ::
::
