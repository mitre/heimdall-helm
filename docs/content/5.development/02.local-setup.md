---
title: Local Development Setup
description: Production-like local Kubernetes environment for Heimdall development and testing
---

# Local Development Setup

Run Heimdall in a production-like local environment with ingress, LoadBalancer support, and stable URLs.

**Use cases:**
- Testing ingress configurations
- OAuth/OIDC provider integration
- TLS certificate setup
- Chart development and debugging
- Integration testing

## Quick Decision: Port-Forward vs Ingress

::tabs
  ::div{label="Port-Forward (Quick Testing)"}
  **Use when:**
  - Testing basic functionality
  - Quick debugging
  - No ingress/OAuth needed

  **Time:** 30 seconds

  ```bash
  kubectl port-forward -n heimdall svc/heimdall 8080:3000
  # Access: http://localhost:8080
  ```

  **Limitations:**
  - Unstable URLs (reconnects frequently)
  - No LoadBalancer/ingress testing
  - Cannot test OAuth/OIDC
  - Not production-like
  ::

  ::div{label="Ingress Setup (Production-Like)"}
  **Use when:**
  - Testing ingress configurations
  - Developing with OAuth/OIDC
  - Testing TLS certificates
  - Need stable URLs
  - Integration testing

  **Time:** 15-20 minutes (one-time setup)

  **Provides:**
  - MetalLB LoadBalancer
  - Traefik ingress controller
  - Stable URL: `http://heimdall.172.18.255.200.nip.io`
  - Production-like environment

  See full setup below.
  ::
::

## Option 1: Automated Setup (Recommended)

Automated script sets up kind cluster with ingress support.

### Prerequisites

```bash
# Required tools
brew install kind helm kubectl

# Verify versions
kind --version        # v0.20.0+
helm version         # v3.14.0+
kubectl version      # v1.28.0+
```

### One-Command Setup

```bash
# From project root
./scripts/local-setup.sh
```

This script:
1. Creates kind cluster with ingress ports exposed
2. Installs MetalLB for LoadBalancer support
3. Installs Traefik ingress controller
4. Deploys Heimdall with ingress enabled
5. Outputs stable access URL

### Expected Output

```
✓ kind cluster created: heimdall-dev
✓ MetalLB installed with IP pool: 172.18.255.200-250
✓ Traefik ingress controller ready
✓ Heimdall deployed

Access Heimdall:
  URL: http://heimdall.172.18.255.200.nip.io

OAuth Callback URLs:
  GitLab: http://heimdall.172.18.255.200.nip.io/authn/gitlab/callback
  GitHub: http://heimdall.172.18.255.200.nip.io/authn/github/callback
  OIDC:   http://heimdall.172.18.255.200.nip.io/authn/oidc_callback
  Okta:   http://heimdall.172.18.255.200.nip.io/authn/okta_callback
```

## Option 2: Manual Setup

Step-by-step manual setup for understanding the process.

### Step 1: Create kind Cluster

```bash
# Create cluster with ingress ports exposed
cat <<EOF | kind create cluster --name heimdall-dev --config=-
kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
nodes:
- role: control-plane
  kubeadmConfigPatches:
  - |
    kind: InitConfiguration
    nodeRegistration:
      kubeletExtraArgs:
        node-labels: "ingress-ready=true"
  extraPortMappings:
  - containerPort: 80
    hostPort: 80
    protocol: TCP
  - containerPort: 443
    hostPort: 443
    protocol: TCP
EOF
```

### Step 2: Install MetalLB

```bash
# Install MetalLB
kubectl apply -f https://raw.githubusercontent.com/metallb/metallb/v0.14.8/config/manifests/metallb-native.yaml

# Wait for MetalLB to be ready
kubectl wait --namespace metallb-system \
  --for=condition=ready pod \
  --selector=app=metallb \
  --timeout=90s

# Configure IP address pool
cat <<EOF | kubectl apply -f -
apiVersion: metallb.io/v1beta1
kind: IPAddressPool
metadata:
  name: kind-pool
  namespace: metallb-system
spec:
  addresses:
  - 172.18.255.200-172.18.255.250
---
apiVersion: metallb.io/v1beta1
kind: L2Advertisement
metadata:
  name: kind-l2
  namespace: metallb-system
spec:
  ipAddressPools:
  - kind-pool
EOF
```

### Step 3: Install Traefik Ingress

```bash
# Add Traefik Helm repo
helm repo add traefik https://traefik.github.io/charts
helm repo update

# Install Traefik
helm install traefik traefik/traefik \
  --namespace traefik \
  --create-namespace \
  --set service.type=LoadBalancer
```

### Step 4: Deploy Heimdall with Ingress

```bash
# Get LoadBalancer IP
LB_IP=$(kubectl get svc -n traefik traefik -o jsonpath='{.status.loadBalancer.ingress[0].ip}')

# Deploy Heimdall
helm install heimdall ./heimdall \
  --namespace heimdall \
  --create-namespace \
  --set heimdall.ingress.enabled=true \
  --set heimdall.ingress.className=traefik \
  --set heimdall.ingress.hosts[0].host=heimdall.${LB_IP}.nip.io

# Wait for deployment
kubectl rollout status statefulset/heimdall -n heimdall

# Show access URL
echo "Access Heimdall: http://heimdall.${LB_IP}.nip.io"
```

## OAuth Configuration for Local Testing

### Using Stable nip.io URLs

The setup provides stable URLs using [nip.io](https://nip.io) DNS service:

```
http://heimdall.172.18.255.200.nip.io
```

How it works:
- `<anything>.<IP>.nip.io` resolves to `<IP>`
- No DNS configuration needed
- Works in air-gapped environments

### Configure OAuth Providers

When setting up OAuth applications (Okta, GitHub, GitLab), use the stable nip.io URL:

**Example: Okta Application**

```
Application Type: Web Application
Sign-in redirect URI: http://heimdall.172.18.255.200.nip.io/authn/okta_callback
Sign-out redirect URI: http://heimdall.172.18.255.200.nip.io
```

**Example: GitHub OAuth App**

```
Application name: Heimdall Local Dev
Homepage URL: http://heimdall.172.18.255.200.nip.io
Authorization callback URL: http://heimdall.172.18.255.200.nip.io/authn/github/callback
```

### Deploy with OAuth Credentials

Create values file with OAuth configuration:

```yaml
# values-local-oauth.yaml
heimdall:
  config:
    EXTERNAL_URL: "http://heimdall.172.18.255.200.nip.io"
    OKTA_DOMAIN: "your-domain.okta.com"
    OKTA_CLIENTID: "your-client-id"

  secrets:
    OKTA_CLIENTSECRET: "your-client-secret"

  ingress:
    enabled: true
    className: traefik
    hosts:
      - host: heimdall.172.18.255.200.nip.io
        paths:
          - path: /
            pathType: Prefix
```

Deploy:

```bash
helm upgrade heimdall ./heimdall \
  -n heimdall \
  -f values-local-oauth.yaml
```

::tip
Use template files from `heimdall/tests/integration/` and create local overrides:
```bash
cp heimdall/tests/integration/values-okta-real.yaml values-okta-local.yaml
# Edit with real credentials (file is gitignored)
```
::

## Accessing Your Local Heimdall

### Check Access URL

```bash
# Get your Heimdall URL
./scripts/get-access-url.sh

# Or manually:
kubectl get ingress -n heimdall
```

### Verify Deployment

```bash
# Check pod status
kubectl get pods -n heimdall

# Check ingress
kubectl get ingress -n heimdall

# View logs
kubectl logs -n heimdall statefulset/heimdall
```

### Test OAuth Flow

1. Open Heimdall URL in browser
2. Click OAuth provider button (e.g., "Okta")
3. Login with provider credentials
4. Verify redirect back to Heimdall

## Troubleshooting

### Ingress Not Accessible

**Check LoadBalancer IP:**
```bash
kubectl get svc -n traefik traefik
```

Expected:
```
NAME      TYPE           CLUSTER-IP      EXTERNAL-IP       PORT(S)
traefik   LoadBalancer   10.96.123.45    172.18.255.200    80:30080/TCP
```

**Verify nip.io resolution:**
```bash
nslookup heimdall.172.18.255.200.nip.io
```

### OAuth Redirect Errors

**Common causes:**
1. `EXTERNAL_URL` includes `/authn` path (remove it)
2. OAuth app callback URL doesn't match deployed URL
3. Port-forward used instead of ingress (URLs change)

**Check deployed configuration:**
```bash
kubectl get configmap -n heimdall heimdall-config -o yaml | grep EXTERNAL_URL
```

### Port 80/443 Already in Use

If ports are in use by another application:

```bash
# Find process using port 80
lsof -i :80

# Kill kind cluster and recreate
kind delete cluster --name heimdall-dev
./scripts/local-setup.sh
```

### MetalLB IP Pool Conflicts

If IP range conflicts with your Docker network:

```bash
# Check Docker network CIDR
docker network inspect kind | grep Subnet

# Adjust IP pool in MetalLB config to match
```

## Cleanup

### Delete Deployment

```bash
# Remove Heimdall
helm uninstall heimdall -n heimdall

# Or delete entire cluster
kind delete cluster --name heimdall-dev
```

### Keep Cluster, Reset Heimdall

```bash
# Uninstall and reinstall
helm uninstall heimdall -n heimdall
helm install heimdall ./heimdall -n heimdall -f your-values.yaml
```

## Next Steps

- [Configure OAuth Authentication](../2.configuration/02.authentication.md)
- [Setup TLS Certificates](../2.configuration/tls/01.overview.md)
- [Testing Guide](./01.testing.md)
- [Ingress Configuration](../2.configuration/ingress/01.overview.md)
