---
title: Manual TLS Certificates
description: Using DoD PKI, corporate CA, or purchased certificates
navigation:
  icon: i-lucide-file-key
---

Manual TLS uses pre-created certificates from DoD PKI, corporate CAs, or purchased from commercial providers.

## Prerequisites

- Certificate file (cert.pem or tls.crt)
- Private key file (key.pem or tls.key)
- Full certificate chain (intermediates + root CA)
- Certificate matches hostname (CN or SAN)
- Private key unencrypted

## Basic Setup

### 1. Prepare Certificate Files

You need three things:
- Server certificate
- Private key
- Certificate chain (intermediates + root CA)

If your certificate has intermediates, combine them into a fullchain file:

```bash
cat server.crt intermediate.crt root.crt > fullchain.crt
```

### 2. Create Kubernetes Secret

```bash
kubectl create secret tls heimdall-tls \
  --cert=fullchain.crt \
  --key=tls.key \
  -n heimdall
```

Verify it was created:
```bash
kubectl get secret heimdall-tls -n heimdall
kubectl describe secret heimdall-tls -n heimdall
```

### 3. Configure Heimdall

```yaml
heimdall:
  ingress:
    enabled: true
    className: "traefik"
    hosts:
      - host: heimdall.example.com
        paths:
          - path: /
    tls:
      - secretName: heimdall-tls
        hosts:
          - heimdall.example.com
```

### 4. Deploy

```bash
helm install heimdall ./heimdall -n heimdall --create-namespace -f values.yaml
```

## Certificate Sources

### DoD PKI Certificates

DoD PKI certificates require special handling for the certificate chain.

**1. Decrypt private key** (if encrypted):

```bash
openssl rsa -in server.key.encrypted -out server.key
```

**2. Combine certificate chain**:

```bash
cat server.cer dod-intermediate-ca.cer dod-root-ca.cer > fullchain.crt
```

**3. Create secret**:

```bash
kubectl create secret tls heimdall-dod-tls \
  --cert=fullchain.crt \
  --key=server.key \
  -n heimdall
```

**4. Configure Heimdall**:

```yaml
heimdall:
  ingress:
    enabled: true
    className: "nginx"
    annotations:
      nginx.ingress.kubernetes.io/ssl-redirect: "true"
    hosts:
      - host: heimdall.navy.mil
        paths:
          - path: /
    tls:
      - secretName: heimdall-dod-tls
        hosts:
          - heimdall.navy.mil
```

**Additional**: If clients need to trust the DoD CA, see [Custom CA Certificates](/helm-chart/configuration/custom-ca-certificates).

### Corporate CA Certificates

For MITRE or other corporate CA certificates:

```bash
# Combine chain
cat mitre-server.crt mitre-intermediate.crt mitre-root.crt > fullchain.crt

# Create secret
kubectl create secret tls heimdall-corp-tls \
  --cert=fullchain.crt \
  --key=mitre-key.key \
  -n heimdall
```

```yaml
heimdall:
  ingress:
    enabled: true
    className: "nginx"
    annotations:
      nginx.ingress.kubernetes.io/ssl-redirect: "true"
    hosts:
      - host: heimdall.internal.corp
        paths:
          - path: /
    tls:
      - secretName: heimdall-corp-tls
        hosts:
          - heimdall.internal.corp
```

::warning{title="Renewal Required"}
Corporate certificates typically expire annually. Set calendar reminders 30-60 days before expiration.
::

### Purchased Certificates (DigiCert, Comodo, etc.)

Commercial certificates from DigiCert, Comodo, or other providers:

```bash
# Combine server cert + intermediate
cat your_domain.crt intermediate.crt > fullchain.crt

# Create secret
kubectl create secret tls heimdall-commercial-tls \
  --cert=fullchain.crt \
  --key=private.key \
  -n heimdall
```

```yaml
heimdall:
  ingress:
    enabled: true
    className: "traefik"
    hosts:
      - host: heimdall.example.com
        paths:
          - path: /
    tls:
      - secretName: heimdall-commercial-tls
        hosts:
          - heimdall.example.com
```

### Self-Signed (Development Only)

For local development and testing:

```bash
openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
  -keyout tls.key -out tls.crt \
  -subj "/CN=heimdall.local/O=Development"

kubectl create secret tls heimdall-dev-tls \
  --cert=tls.crt \
  --key=tls.key \
  -n heimdall
```

::warning
Self-signed certificates show browser warnings. Only use for development.
::

## Alternative: Create Secret from YAML

Instead of using `kubectl create secret`, you can create the secret from YAML:

```bash
kubectl apply -f - <<EOF
apiVersion: v1
kind: Secret
metadata:
  name: heimdall-tls
  namespace: heimdall
type: kubernetes.io/tls
data:
  tls.crt: $(cat fullchain.crt | base64 -w0)
  tls.key: $(cat tls.key | base64 -w0)
EOF
```

## Certificate Renewal

::warning{title="Manual Renewal Required"}
Manual certificates do NOT auto-renew. Set reminders 30-60 days before expiration.
::

### Check Expiration Date

```bash
kubectl get secret heimdall-tls -n heimdall -o jsonpath='{.data.tls\.crt}' | \
  base64 -d | openssl x509 -noout -enddate
```

### Renew Certificate

**1. Delete old secret**:

```bash
kubectl delete secret heimdall-tls -n heimdall
```

**2. Create new secret with renewed certificate**:

```bash
kubectl create secret tls heimdall-tls \
  --cert=new-fullchain.crt \
  --key=new-key.key \
  -n heimdall
```

**3. Restart pods** (if needed):

```bash
kubectl rollout restart statefulset heimdall -n heimdall
```

## Verify Certificate

### Check Certificate Subject and SAN

```bash
kubectl get secret heimdall-tls -n heimdall -o jsonpath='{.data.tls\.crt}' | \
  base64 -d | openssl x509 -noout -text | grep -A1 "Subject Alternative Name"
```

### Check Expiration Dates

```bash
kubectl get secret heimdall-tls -n heimdall -o jsonpath='{.data.tls\.crt}' | \
  base64 -d | openssl x509 -noout -dates
```

### Check Certificate Chain

```bash
kubectl get secret heimdall-tls -n heimdall -o jsonpath='{.data.tls\.crt}' | \
  base64 -d | openssl crl2pkcs7 -nocrl -certfile /dev/stdin | \
  openssl pkcs7 -print_certs -noout
```

## Common Scenarios

### Production Internal Deployment

For internal corporate deployments with corporate CA:

```yaml
heimdall:
  ingress:
    enabled: true
    className: "nginx"
    annotations:
      nginx.ingress.kubernetes.io/ssl-redirect: "true"
    hosts:
      - host: heimdall.internal.corp
        paths:
          - path: /
    tls:
      - secretName: heimdall-corp-tls
        hosts:
          - heimdall.internal.corp
```

Pre-create the secret:
```bash
kubectl create secret tls heimdall-corp-tls \
  --cert=fullchain.crt \
  --key=private.key \
  -n heimdall
```

### DoD/Government Deployment

For DoD or government deployments with PKI requirements:

```bash
# Decrypt key
openssl rsa -in server.key.encrypted -out server.key

# Combine chain
cat server.cer dod-intermediate-ca.cer dod-root-ca.cer > fullchain.crt

# Create secret
kubectl create secret tls heimdall-dod-tls \
  --cert=fullchain.crt \
  --key=server.key \
  -n heimdall
```

```yaml
heimdall:
  ingress:
    enabled: true
    className: "nginx"
    annotations:
      nginx.ingress.kubernetes.io/ssl-redirect: "true"
    hosts:
      - host: heimdall.navy.mil
        paths:
          - path: /
    tls:
      - secretName: heimdall-dod-tls
        hosts:
          - heimdall.navy.mil
```

## See Also

- [TLS Overview](/helm-chart/configuration/tls/overview) - Choose the right TLS approach
- [Automated TLS](/helm-chart/configuration/tls/automated) - cert-manager setup
- [TLS Troubleshooting](/helm-chart/configuration/tls/troubleshooting) - Common issues
- [Custom CA Certificates](/helm-chart/configuration/custom-ca-certificates) - Trust custom CAs
