---
title: Automated TLS (cert-manager)
description: cert-manager setup with Let's Encrypt for automatic certificate management
navigation:
  icon: i-lucide-bot
---

Automated TLS uses **cert-manager** to request and renew certificates from Let's Encrypt or other ACME providers.

## Prerequisites

- Kubernetes cluster with ingress controller
- DNS pointing to your ingress controller
- Port 80 accessible (for HTTP-01 challenge)
- Or DNS provider credentials (for DNS-01 wildcard certs)

## Installation

### 1. Install cert-manager

```bash
kubectl apply -f https://github.com/cert-manager/cert-manager/releases/download/v1.13.0/cert-manager.yaml
```

### 2. Verify Installation

```bash
kubectl get pods -n cert-manager
```

Expected output: 3 running pods (cert-manager, cainjector, webhook)

### 3. Create ClusterIssuer

::tip{title="Test with Staging First"}
Use the staging issuer first to avoid Let's Encrypt rate limits (50 certificates per week per domain).
::

**Staging issuer** (for testing):

```yaml
apiVersion: cert-manager.io/v1
kind: ClusterIssuer
metadata:
  name: letsencrypt-staging
spec:
  acme:
    server: https://acme-staging-v02.api.letsencrypt.org/directory
    email: admin@example.com  # Change this
    privateKeySecretRef:
      name: letsencrypt-staging
    solvers:
    - http01:
        ingress:
          class: traefik  # Match your ingress controller
```

Apply it:
```bash
kubectl apply -f clusterissuer-staging.yaml
```

**Production issuer** (after testing works):

```yaml
apiVersion: cert-manager.io/v1
kind: ClusterIssuer
metadata:
  name: letsencrypt-prod
spec:
  acme:
    server: https://acme-v02.api.letsencrypt.org/directory
    email: admin@example.com  # Change this
    privateKeySecretRef:
      name: letsencrypt-prod
    solvers:
    - http01:
        ingress:
          class: traefik  # Match your ingress controller
```

Apply it:
```bash
kubectl apply -f clusterissuer-prod.yaml
```

### 4. Configure Heimdall

Update your `values.yaml`:

```yaml
heimdall:
  ingress:
    enabled: true
    className: "traefik"
    annotations:
      cert-manager.io/cluster-issuer: "letsencrypt-staging"  # Start with staging
    hosts:
      - host: heimdall.example.com
        paths:
          - path: /
    tls:
      - secretName: heimdall-tls
        hosts:
          - heimdall.example.com
```

### 5. Deploy

```bash
helm install heimdall ./heimdall -n heimdall --create-namespace -f values.yaml
```

### 6. Verify Certificate

```bash
kubectl get certificate -n heimdall
```

Should show: `READY=True`

Check details:
```bash
kubectl describe certificate heimdall-tls -n heimdall
```

### 7. Switch to Production

After verifying staging works, update your values:

```yaml
heimdall:
  ingress:
    annotations:
      cert-manager.io/cluster-issuer: "letsencrypt-prod"  # Change to prod
```

Delete the staging certificate to force renewal:
```bash
kubectl delete certificate heimdall-tls -n heimdall
kubectl delete secret heimdall-tls -n heimdall
```

Upgrade:
```bash
helm upgrade heimdall ./heimdall -n heimdall -f values.yaml
```

## Wildcard Certificates (DNS-01)

For wildcard domains like `*.example.com`, use DNS-01 challenge with your DNS provider.

### Route53 (AWS)

```yaml
apiVersion: cert-manager.io/v1
kind: ClusterIssuer
metadata:
  name: letsencrypt-dns
spec:
  acme:
    server: https://acme-v02.api.letsencrypt.org/directory
    email: admin@example.com
    privateKeySecretRef:
      name: letsencrypt-dns
    solvers:
    - dns01:
        route53:
          region: us-east-1
          accessKeyID: AKIAIOSFODNN7EXAMPLE
          secretAccessKeySecretRef:
            name: route53-credentials
            key: secret-access-key
```

Create the Route53 credentials secret:
```bash
kubectl create secret generic route53-credentials \
  --namespace cert-manager \
  --from-literal=secret-access-key="YOUR_AWS_SECRET_KEY"
```

### CloudDNS (GCP)

```yaml
apiVersion: cert-manager.io/v1
kind: ClusterIssuer
metadata:
  name: letsencrypt-dns
spec:
  acme:
    server: https://acme-v02.api.letsencrypt.org/directory
    email: admin@example.com
    privateKeySecretRef:
      name: letsencrypt-dns
    solvers:
    - dns01:
        cloudDNS:
          project: my-gcp-project
          serviceAccountSecretRef:
            name: clouddns-credentials
            key: key.json
```

Create the CloudDNS credentials secret:
```bash
kubectl create secret generic clouddns-credentials \
  --namespace cert-manager \
  --from-file=key.json=./gcp-service-account.json
```

### Cloudflare

```yaml
apiVersion: cert-manager.io/v1
kind: ClusterIssuer
metadata:
  name: letsencrypt-dns
spec:
  acme:
    server: https://acme-v02.api.letsencrypt.org/directory
    email: admin@example.com
    privateKeySecretRef:
      name: letsencrypt-dns
    solvers:
    - dns01:
        cloudflare:
          email: admin@example.com
          apiTokenSecretRef:
            name: cloudflare-api-token
            key: api-token
```

Create the Cloudflare API token secret:
```bash
kubectl create secret generic cloudflare-api-token \
  --namespace cert-manager \
  --from-literal=api-token="YOUR_CLOUDFLARE_API_TOKEN"
```

## Common Scenarios

### Local Development with Self-Signed Cert

For local testing (browser will show warnings):

```bash
openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
  -keyout tls.key -out tls.crt \
  -subj "/CN=heimdall.local/O=Development"

kubectl create secret tls heimdall-dev-tls \
  --cert=tls.crt --key=tls.key -n heimdall
```

```yaml
heimdall:
  ingress:
    enabled: true
    hosts:
      - host: heimdall.local
    tls:
      - secretName: heimdall-dev-tls
        hosts:
          - heimdall.local
```

Add to `/etc/hosts`:
```
127.0.0.1 heimdall.local
```

### Production Internet-Facing

```yaml
heimdall:
  ingress:
    enabled: true
    className: "traefik"
    annotations:
      cert-manager.io/cluster-issuer: "letsencrypt-prod"
      traefik.ingress.kubernetes.io/router.entrypoints: websecure
    hosts:
      - host: heimdall.example.com
        paths:
          - path: /
    tls:
      - secretName: heimdall-tls
        hosts:
          - heimdall.example.com
```

Prerequisites:
- cert-manager installed
- DNS pointing to ingress
- Port 80 accessible for HTTP-01 challenge

## Certificate Renewal

cert-manager automatically renews certificates 60 days before expiration.

Check renewal status:
```bash
kubectl describe certificate heimdall-tls -n heimdall
```

Look for `Renewal Time` in the output.

Force immediate renewal:
```bash
kubectl delete secret heimdall-tls -n heimdall
# cert-manager will recreate it automatically
```

## See Also

- [TLS Overview](/helm-chart/configuration/tls/overview) - Choose the right TLS approach
- [Manual TLS](/helm-chart/configuration/tls/manual) - DoD PKI and corporate certificates
- [TLS Troubleshooting](/helm-chart/configuration/tls/troubleshooting) - Common issues
- [cert-manager Documentation](https://cert-manager.io/docs/) - Official docs
