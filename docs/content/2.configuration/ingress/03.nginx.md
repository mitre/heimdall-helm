---
title: Nginx Ingress Controller
description: Setup and configure Nginx for Heimdall
navigation:
  icon: i-lucide-server
---

::warning{title="Retirement Notice"}
The Nginx Ingress Controller project announced retirement in March 2026. Consider using Traefik for new deployments.
::

## Installation

### Option 1: Official Manifests

```bash
kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/main/deploy/static/provider/cloud/deploy.yaml
```

### Option 2: Helm Chart

```bash
helm repo add ingress-nginx https://kubernetes.github.io/ingress-nginx
helm repo update
helm install nginx-ingress ingress-nginx/ingress-nginx -n ingress-nginx --create-namespace
```

### Verify Installation

```bash
kubectl get pods -n ingress-nginx
```

Expected output showing running pods.

## Basic Configuration

```yaml
heimdall:
  ingress:
    enabled: true
    className: "nginx"
    annotations:
      nginx.ingress.kubernetes.io/ssl-redirect: "true"
      cert-manager.io/cluster-issuer: "letsencrypt-prod"
    hosts:
      - host: heimdall.example.com
        paths:
          - path: /
            pathType: Prefix
    tls:
      - secretName: heimdall-tls
        hosts:
          - heimdall.example.com
```

## Common Annotations

### Upload Size Limits

::note
Default Nginx limit is 1m (1 megabyte). Heimdall XCCDF uploads often exceed this.
::

```yaml
annotations:
  # Increase max body size (for large XCCDF files)
  nginx.ingress.kubernetes.io/proxy-body-size: "100m"

  # No limit
  nginx.ingress.kubernetes.io/proxy-body-size: "0"
```

### Force HTTPS

```yaml
annotations:
  # Redirect HTTP → HTTPS
  nginx.ingress.kubernetes.io/ssl-redirect: "true"

  # Force SSL redirect even if behind proxy
  nginx.ingress.kubernetes.io/force-ssl-redirect: "true"

  # HSTS header
  nginx.ingress.kubernetes.io/hsts: "true"
  nginx.ingress.kubernetes.io/hsts-max-age: "31536000"
```

### Timeout Settings

```yaml
annotations:
  # Read timeout (for long-running requests)
  nginx.ingress.kubernetes.io/proxy-read-timeout: "600"

  # Send timeout
  nginx.ingress.kubernetes.io/proxy-send-timeout: "600"

  # Connect timeout
  nginx.ingress.kubernetes.io/proxy-connect-timeout: "30"
```

### Session Affinity

```yaml
annotations:
  # Enable session affinity
  nginx.ingress.kubernetes.io/affinity: "cookie"

  # Cookie name
  nginx.ingress.kubernetes.io/session-cookie-name: "heimdall-session"

  # Cookie expiration (seconds)
  nginx.ingress.kubernetes.io/session-cookie-max-age: "3600"
```

## Complete Example

Full production configuration:

```yaml
heimdall:
  ingress:
    enabled: true
    className: "nginx"
    annotations:
      # cert-manager
      cert-manager.io/cluster-issuer: "letsencrypt-prod"

      # Force HTTPS
      nginx.ingress.kubernetes.io/ssl-redirect: "true"
      nginx.ingress.kubernetes.io/force-ssl-redirect: "true"

      # Security headers
      nginx.ingress.kubernetes.io/hsts: "true"
      nginx.ingress.kubernetes.io/hsts-max-age: "31536000"

      # Upload limits (for XCCDF files)
      nginx.ingress.kubernetes.io/proxy-body-size: "100m"

      # Timeouts
      nginx.ingress.kubernetes.io/proxy-read-timeout: "600"
      nginx.ingress.kubernetes.io/proxy-send-timeout: "600"

      # Session affinity (if using multiple replicas)
      nginx.ingress.kubernetes.io/affinity: "cookie"
      nginx.ingress.kubernetes.io/session-cookie-name: "heimdall-session"

    hosts:
      - host: heimdall.example.com
        paths:
          - path: /
            pathType: Prefix

    tls:
      - secretName: heimdall-tls
        hosts:
          - heimdall.example.com
```

## Advanced Configuration

### Rate Limiting

```yaml
annotations:
  # Limit requests per second
  nginx.ingress.kubernetes.io/limit-rps: "10"

  # Limit connections
  nginx.ingress.kubernetes.io/limit-connections: "100"
```

### IP Whitelist

```yaml
annotations:
  # Allow specific IPs
  nginx.ingress.kubernetes.io/whitelist-source-range: "192.168.1.0/24,10.0.0.0/8"
```

### Custom Headers

```yaml
annotations:
  # Add custom headers
  nginx.ingress.kubernetes.io/configuration-snippet: |
    more_set_headers "X-Frame-Options: DENY";
    more_set_headers "X-Content-Type-Options: nosniff";
```

### Basic Auth

Create auth file:
```bash
htpasswd -c auth admin
kubectl create secret generic basic-auth --from-file=auth -n heimdall
```

Use in ingress:
```yaml
annotations:
  nginx.ingress.kubernetes.io/auth-type: basic
  nginx.ingress.kubernetes.io/auth-secret: basic-auth
  nginx.ingress.kubernetes.io/auth-realm: "Authentication Required"
```

## DoD/Government Deployment

For DoD PKI certificates:

```yaml
heimdall:
  ingress:
    enabled: true
    className: "nginx"
    annotations:
      nginx.ingress.kubernetes.io/ssl-redirect: "true"
      nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
      nginx.ingress.kubernetes.io/proxy-body-size: "100m"
      nginx.ingress.kubernetes.io/proxy-read-timeout: "600"

    hosts:
      - host: heimdall.navy.mil
        paths:
          - path: /
            pathType: Prefix

    tls:
      - secretName: dod-cert-secret
        hosts:
          - heimdall.navy.mil
```

Pre-create TLS secret:
```bash
cat server.cer dod-intermediate.cer dod-root.cer > fullchain.crt

kubectl create secret tls dod-cert-secret \
  --cert=fullchain.crt \
  --key=server.key \
  -n heimdall
```

## Common Issues

### 413 Request Entity Too Large

Increase body size limit:
```yaml
annotations:
  nginx.ingress.kubernetes.io/proxy-body-size: "100m"
```

### 504 Gateway Timeout

Increase timeouts:
```yaml
annotations:
  nginx.ingress.kubernetes.io/proxy-read-timeout: "600"
  nginx.ingress.kubernetes.io/proxy-send-timeout: "600"
```

### Backend Service Not Found

Check service exists:
```bash
kubectl get svc -n heimdall
kubectl get endpoints -n heimdall
```

## Migration to Traefik

If migrating from Nginx to Traefik:

**Nginx annotation → Traefik equivalent:**

| Nginx | Traefik |
|-------|---------|
| `nginx.ingress.kubernetes.io/ssl-redirect: "true"` | `traefik.ingress.kubernetes.io/router.entrypoints: websecure` |
| `nginx.ingress.kubernetes.io/proxy-body-size: "100m"` | No equivalent (Traefik has no default limit) |
| `nginx.ingress.kubernetes.io/affinity: "cookie"` | `traefik.ingress.kubernetes.io/service.sticky.cookie: "true"` |
| `nginx.ingress.kubernetes.io/proxy-read-timeout: "600"` | `traefik.ingress.kubernetes.io/router.timeout.request: "600s"` |

## See Also

- [Ingress Overview](/helm-chart/configuration/ingress/overview) - Compare ingress controllers
- [Traefik Setup](/helm-chart/configuration/ingress/traefik) - Recommended alternative
- [TLS Configuration](/helm-chart/configuration/tls/overview) - HTTPS setup
- [Ingress Troubleshooting](/helm-chart/configuration/ingress/troubleshooting) - Common issues
