---
title: Cloud Provider Load Balancers
description: AWS ALB, GCP Load Balancer, and Azure App Gateway
navigation:
  icon: i-lucide-cloud
---

Cloud-native load balancers for managed Kubernetes services.

## AWS Application Load Balancer (ALB)

### Prerequisites

- Amazon EKS cluster
- AWS Load Balancer Controller installed

### Install AWS Load Balancer Controller

```bash
# Add EKS Helm repository
helm repo add eks https://aws.github.io/eks-charts
helm repo update

# Install controller
helm install aws-load-balancer-controller eks/aws-load-balancer-controller \
  -n kube-system \
  --set clusterName=<your-cluster-name>
```

Verify:
```bash
kubectl get deployment -n kube-system aws-load-balancer-controller
```

### Internet-Facing ALB

```yaml
heimdall:
  ingress:
    enabled: true
    className: "alb"
    annotations:
      # ALB scheme
      alb.ingress.kubernetes.io/scheme: internet-facing

      # Target type (ip or instance)
      alb.ingress.kubernetes.io/target-type: ip

      # ACM certificate ARN
      alb.ingress.kubernetes.io/certificate-arn: arn:aws:acm:us-east-1:123456789012:certificate/abc123

      # Listen ports
      alb.ingress.kubernetes.io/listen-ports: '[{"HTTP": 80}, {"HTTPS": 443}]'

      # SSL redirect
      alb.ingress.kubernetes.io/ssl-redirect: "443"

    hosts:
      - host: heimdall.example.com
        paths:
          - path: /
            pathType: Prefix
```

### Internal ALB

```yaml
heimdall:
  ingress:
    enabled: true
    className: "alb"
    annotations:
      alb.ingress.kubernetes.io/scheme: internal
      alb.ingress.kubernetes.io/target-type: ip
      alb.ingress.kubernetes.io/subnets: subnet-abc123,subnet-def456

    hosts:
      - host: heimdall.internal.corp
        paths:
          - path: /
            pathType: Prefix
```

### Common ALB Annotations

```yaml
annotations:
  # Health check
  alb.ingress.kubernetes.io/healthcheck-path: /health_check
  alb.ingress.kubernetes.io/healthcheck-interval-seconds: "15"
  alb.ingress.kubernetes.io/success-codes: "200"

  # Session affinity
  alb.ingress.kubernetes.io/target-group-attributes: stickiness.enabled=true,stickiness.lb_cookie.duration_seconds=3600

  # WAF
  alb.ingress.kubernetes.io/wafv2-acl-arn: arn:aws:wafv2:us-east-1:123456789012:global/webacl/example/abc123
```

### Complete Example

```yaml
heimdall:
  ingress:
    enabled: true
    className: "alb"
    annotations:
      alb.ingress.kubernetes.io/scheme: internet-facing
      alb.ingress.kubernetes.io/target-type: ip
      alb.ingress.kubernetes.io/certificate-arn: arn:aws:acm:us-east-1:123456789012:certificate/abc123
      alb.ingress.kubernetes.io/listen-ports: '[{"HTTP": 80}, {"HTTPS": 443}]'
      alb.ingress.kubernetes.io/ssl-redirect: "443"
      alb.ingress.kubernetes.io/healthcheck-path: /health_check
      alb.ingress.kubernetes.io/target-group-attributes: stickiness.enabled=true

    hosts:
      - host: heimdall.example.com
        paths:
          - path: /
            pathType: Prefix
```

---

## Google Cloud Load Balancer

### Prerequisites

- Google GKE cluster
- GCE ingress controller (pre-installed in GKE)

### Reserve Static IP

```bash
gcloud compute addresses create heimdall-ip --global
```

### Create Managed Certificate

```yaml
apiVersion: networking.gke.io/v1
kind: ManagedCertificate
metadata:
  name: heimdall-cert
  namespace: heimdall
spec:
  domains:
    - heimdall.example.com
```

Apply:
```bash
kubectl apply -f managed-cert.yaml
```

### Configure Ingress

```yaml
heimdall:
  ingress:
    enabled: true
    className: "gce"
    annotations:
      # Use reserved static IP
      kubernetes.io/ingress.global-static-ip-name: "heimdall-ip"

      # Use managed certificate
      networking.gke.io/managed-certificates: "heimdall-cert"

      # Backend configuration (optional)
      cloud.google.com/backend-config: '{"default": "heimdall-backend-config"}'

    hosts:
      - host: heimdall.example.com
        paths:
          - path: /
            pathType: Prefix
```

### Backend Configuration

Create BackendConfig for advanced settings:

```yaml
apiVersion: cloud.google.com/v1
kind: BackendConfig
metadata:
  name: heimdall-backend-config
  namespace: heimdall
spec:
  timeoutSec: 600  # Request timeout
  connectionDraining:
    drainingTimeoutSec: 60
  sessionAffinity:
    affinityType: "CLIENT_IP"
    affinityCookieTtlSec: 3600
  healthCheck:
    checkIntervalSec: 15
    port: 3000
    type: HTTP
    requestPath: /health_check
```

Apply:
```bash
kubectl apply -f backend-config.yaml
```

### Complete Example

```yaml
heimdall:
  ingress:
    enabled: true
    className: "gce"
    annotations:
      kubernetes.io/ingress.global-static-ip-name: "heimdall-ip"
      networking.gke.io/managed-certificates: "heimdall-cert"
      cloud.google.com/backend-config: '{"default": "heimdall-backend-config"}'

    hosts:
      - host: heimdall.example.com
        paths:
          - path: /
            pathType: Prefix
```

---

## Azure Application Gateway

### Prerequisites

- Azure AKS cluster
- Application Gateway Ingress Controller (AGIC)

### Enable AGIC Add-on

```bash
az aks enable-addons \
  -n <aks-cluster-name> \
  -g <resource-group> \
  -a ingress-appgw \
  --appgw-name <appgw-name>
```

### Or Install via Helm

```bash
helm repo add application-gateway-kubernetes-ingress https://appgwingress.blob.core.windows.net/ingress-azure-helm-package/
helm repo update
helm install ingress-azure application-gateway-kubernetes-ingress/ingress-azure \
  --namespace default
```

### Basic Configuration

```yaml
heimdall:
  ingress:
    enabled: true
    className: "azure/application-gateway"
    annotations:
      # Force HTTPS redirect
      appgw.ingress.kubernetes.io/ssl-redirect: "true"

      # Backend protocol
      appgw.ingress.kubernetes.io/backend-protocol: "http"

      # Health probe
      appgw.ingress.kubernetes.io/health-probe-path: "/health_check"

    hosts:
      - host: heimdall.example.com
        paths:
          - path: /
            pathType: Prefix

    tls:
      - secretName: heimdall-tls
        hosts:
          - heimdall.example.com
```

### Common Azure Annotations

```yaml
annotations:
  # Request timeout
  appgw.ingress.kubernetes.io/request-timeout: "600"

  # Connection draining
  appgw.ingress.kubernetes.io/connection-draining: "true"
  appgw.ingress.kubernetes.io/connection-draining-timeout: "60"

  # Session affinity
  appgw.ingress.kubernetes.io/cookie-based-affinity: "true"

  # WAF policy
  appgw.ingress.kubernetes.io/waf-policy-for-path: "/subscriptions/.../resourceGroups/.../providers/Microsoft.Network/applicationGatewayWebApplicationFirewallPolicies/..."
```

### Complete Example

```yaml
heimdall:
  ingress:
    enabled: true
    className: "azure/application-gateway"
    annotations:
      appgw.ingress.kubernetes.io/ssl-redirect: "true"
      appgw.ingress.kubernetes.io/backend-protocol: "http"
      appgw.ingress.kubernetes.io/health-probe-path: "/health_check"
      appgw.ingress.kubernetes.io/request-timeout: "600"
      appgw.ingress.kubernetes.io/cookie-based-affinity: "true"

    hosts:
      - host: heimdall.example.com
        paths:
          - path: /
            pathType: Prefix

    tls:
      - secretName: heimdall-tls
        hosts:
          - heimdall.example.com
```

---

## Comparison

| Feature | AWS ALB | GCP Load Balancer | Azure App Gateway |
|---------|---------|-------------------|-------------------|
| **Managed Certificates** | ACM | Managed Certificates | Key Vault |
| **WAF Integration** | AWS WAF | Cloud Armor | Azure WAF |
| **Health Checks** | ✅ | ✅ | ✅ |
| **Session Affinity** | ✅ | ✅ | ✅ |
| **WebSocket Support** | ✅ | ✅ | ✅ |
| **Global Load Balancing** | ❌ | ✅ | ❌ |

## See Also

- [Ingress Overview](/helm-chart/configuration/ingress/overview) - Compare all ingress controllers
- [TLS Configuration](/helm-chart/configuration/tls/overview) - HTTPS setup
- [Ingress Troubleshooting](/helm-chart/configuration/ingress/troubleshooting) - Common issues
