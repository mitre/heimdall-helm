---
title: Ingress Troubleshooting
description: Common ingress issues and solutions
navigation:
  icon: i-lucide-wrench
---

Common ingress problems and how to fix them.

## Ingress Not Created

**Symptom**: `kubectl get ingress -n heimdall` returns empty

### Check if Ingress is Enabled

```bash
helm get values heimdall -n heimdall | grep -A5 ingress
```

Verify `enabled: true` is set.

### Enable Ingress

```bash
helm upgrade --install heimdall ./heimdall -n heimdall \
  --set heimdall.ingress.enabled=true
```

### Verify Chart Installation

```bash
kubectl get all -n heimdall
```

If Heimdall pods exist but no ingress, ingress is disabled in values.

---

## 404 Not Found

**Symptom**: Accessing ingress URL returns "404 Not Found"

### Verify Ingress Rules

```bash
kubectl describe ingress -n heimdall
```

Check:
- **Host** matches your DNS (`heimdall.example.com`)
- **Path** is correct (`/`)
- **Backend** service exists and is healthy

### Check Backend Service

```bash
kubectl get svc -n heimdall
kubectl get endpoints -n heimdall
```

If endpoints are empty, pods aren't ready.

### Test Service Directly

```bash
kubectl port-forward -n heimdall svc/heimdall 8080:3000
curl http://localhost:8080
```

If port-forward works but ingress doesn't, issue is in ingress configuration.

---

## TLS Certificate Issues

**Symptom**: HTTPS not working or browser shows "Not Secure"

### Check Certificate Status (cert-manager)

```bash
kubectl get certificate -n heimdall
kubectl describe certificate heimdall-tls -n heimdall
```

Look for `Ready: True`. If `False`, check events for errors.

### Check Secret Exists

```bash
kubectl get secret heimdall-tls -n heimdall
```

If missing:
- **cert-manager**: Check Certificate resource and CertificateRequest
- **Manual**: Create secret with `kubectl create secret tls`

### View Certificate Details

```bash
kubectl get secret heimdall-tls -n heimdall -o jsonpath='{.data.tls\.crt}' | \
  base64 -d | openssl x509 -text -noout
```

Verify:
- Subject Alternative Name (SAN) matches your hostname
- Not expired (`notAfter` date)
- Issued by expected CA

---

## Ingress Controller Not Installed

**Symptom**: Ingress created but not accessible

### Check for Traefik

```bash
kubectl get pods -n traefik
```

### Check for Nginx

```bash
kubectl get pods -n ingress-nginx
```

### Check for Kong

```bash
kubectl get pods -n kong
```

### Install Missing Controller

If no controller is running, install one:

**Traefik**:
```bash
helm repo add traefik https://traefik.github.io/charts
helm install traefik traefik/traefik -n traefik --create-namespace
```

**Nginx**:
```bash
helm repo add ingress-nginx https://kubernetes.github.io/ingress-nginx
helm install nginx-ingress ingress-nginx/ingress-nginx -n ingress-nginx --create-namespace
```

### Verify Ingress Class

```bash
kubectl get ingressclass
```

Ensure your `className` in values.yaml matches an available IngressClass.

---

## DNS Not Resolving

**Symptom**: "Server not found" or DNS errors

### Check DNS Configuration

```bash
nslookup heimdall.example.com
dig heimdall.example.com
```

### Get Ingress External IP

```bash
kubectl get ingress -n heimdall
```

DNS should point to the EXTERNAL-IP or ADDRESS shown.

### Cloud Load Balancers

- **AWS ALB**: DNS CNAME to ALB hostname
- **GCP**: A record to static IP
- **Azure**: A record to App Gateway public IP

### Local Testing

Add to `/etc/hosts` for local testing:
```
<ingress-external-ip> heimdall.example.com
```

---

## 502 Bad Gateway

**Symptom**: "502 Bad Gateway" error

### Check Pod Status

```bash
kubectl get pods -n heimdall
```

All pods should be `Running` and `READY 1/1`.

### Check Pod Logs

```bash
kubectl logs -n heimdall -l app.kubernetes.io/name=heimdall
```

Look for startup errors or crashes.

### Check Health Probes

```bash
kubectl describe pod -n heimdall <pod-name>
```

Look for `Readiness probe failed` or `Liveness probe failed`.

### Test Health Endpoint

```bash
kubectl port-forward -n heimdall <pod-name> 8080:3000
curl http://localhost:8080/health_check
```

Should return `200 OK`.

---

## 503 Service Unavailable

**Symptom**: "503 Service Unavailable"

### Check Service Endpoints

```bash
kubectl get endpoints -n heimdall
```

If empty, no pods are ready to serve traffic.

### Check Pod Readiness

```bash
kubectl get pods -n heimdall -o wide
```

Look for `READY 0/1` status.

### Check Readiness Probe

```bash
kubectl describe pod -n heimdall <pod-name>
```

Look for:
- `Readiness probe failed`
- `Unhealthy` events

### Common Causes

- Database not ready
- Migrations not complete
- Application startup timeout

---

## 504 Gateway Timeout

**Symptom**: "504 Gateway Timeout"

### Increase Timeout (Nginx)

```yaml
annotations:
  nginx.ingress.kubernetes.io/proxy-read-timeout: "600"
  nginx.ingress.kubernetes.io/proxy-send-timeout: "600"
```

### Increase Timeout (Traefik)

```yaml
annotations:
  traefik.ingress.kubernetes.io/router.timeout.request: "600s"
```

### Check Application Performance

```bash
kubectl logs -n heimdall -l app.kubernetes.io/name=heimdall
```

Look for slow queries or performance issues.

---

## 413 Request Entity Too Large (Nginx)

**Symptom**: "413 Request Entity Too Large" when uploading XCCDF files

### Increase Body Size Limit

```yaml
annotations:
  nginx.ingress.kubernetes.io/proxy-body-size: "100m"
```

Or remove limit:
```yaml
annotations:
  nginx.ingress.kubernetes.io/proxy-body-size: "0"
```

---

## Certificate Validation Failed

**Symptom**: "unable to get local issuer certificate"

### Check Certificate Chain

```bash
kubectl get secret heimdall-tls -n heimdall -o jsonpath='{.data.tls\.crt}' | \
  base64 -d | openssl crl2pkcs7 -nocrl -certfile /dev/stdin | \
  openssl pkcs7 -print_certs -noout
```

Should show server cert + intermediate(s) + root CA.

### Recreate Secret with Full Chain

```bash
cat server.crt intermediate.crt root.crt > fullchain.crt

kubectl delete secret heimdall-tls -n heimdall
kubectl create secret tls heimdall-tls \
  --cert=fullchain.crt \
  --key=tls.key \
  -n heimdall
```

---

## Ingress Controller Logs

### Traefik Logs

```bash
kubectl logs -n traefik -l app.kubernetes.io/name=traefik -f
```

### Nginx Logs

```bash
kubectl logs -n ingress-nginx -l app.kubernetes.io/name=ingress-nginx -f
```

### Kong Logs

```bash
kubectl logs -n kong -l app.kubernetes.io/name=kong -f
```

Look for routing errors, backend failures, or TLS issues.

---

## Check Ingress Events

```bash
kubectl describe ingress -n heimdall
```

Look at the `Events` section for errors or warnings.

---

## Verify Service Port

```bash
kubectl get svc heimdall -n heimdall -o yaml
```

Verify port `3000` is exposed and `targetPort` matches container port.

---

## Check Network Policies

If using NetworkPolicies, verify ingress controller can reach Heimdall:

```bash
kubectl get networkpolicies -n heimdall
```

Ensure policies allow traffic from ingress namespace.

---

## Debug with Temporary Pod

Create debug pod to test connectivity:

```bash
kubectl run -it --rm debug --image=curlimages/curl --restart=Never -- sh
```

From inside pod:
```sh
curl http://heimdall.heimdall.svc.cluster.local:3000/health_check
```

Should return `200 OK`.

---

## See Also

- [Ingress Overview](/helm-chart/configuration/ingress/overview) - Compare ingress controllers
- [TLS Troubleshooting](/helm-chart/configuration/tls/troubleshooting) - Certificate issues
- [Health Probes](/helm-chart/advanced/health-and-availability) - Readiness and liveness probes
